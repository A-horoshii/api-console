<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../arc-icons/arc-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="raml-tree-item-behavior.html">
<link rel="import" href="raml-tree-item-styles.html">
<link rel="import" href="path-selector-resource.html">

</head><body><dom-module id="raml-resource-tree-item">
  <template>
    <style include="raml-tree-item-styles">
    *:focus {
      outline: none;
    }

    paper-icon-button.toggle-button {
      transition: all 0.4s ease;
      padding: 0;
      width: 24px;
      height: 24px;
      min-width: 24px;
      transform: rotateZ(-90deg);
    }
    /* In shaggy DOM there must be an exact path for recursive elements */

     :host([opened])>paper-item>paper-icon-button.toggle-button {
      transform: rotateZ(0deg)
    }

    .resource-name {
      @apply(--layout-flex);
    }

    paper-item {
      white-space: nowrap;
    }

    .method-name-item {
      padding-left: 24px;
    }

    .method {
      @apply(--method-display-box);
    }

    .selected .method,
    .selected .method.get,
    .selected .method.post,
    .selected .method.put,
    .selected .method.delete,
    .selected .method.patch {
      @apply(--method-display-box-selected);
    }

    .method.get {
      @apply(--method-display-box-get);
    }

    .method.post {
      @apply(--method-display-box-post);
    }

    .method.put {
      @apply(--method-display-box-put);
    }

    .method.delete {
      @apply(--method-display-box-delete);
    }

    .method.patch {
      @apply(--method-display-box-patch);
    }

    .method-description {
      @apply(--layout-horizontal);
      @apply(--layout-center);
    }

    .method-display {
      @apply(--layout-flex);
    }

     :host([narrow]) .resource-details-item {
      padding-right: 0;
    }

    .enter-button {
      color: var(--raml-path-selector-toggle-icon-color, rgba(0, 0, 0, 0.54));
    }
    </style>
    <paper-item data-path$="[[path]]" on-tap="_selectPath" class$="indentable-content resource-details-item [[_computeItemSelectableClass(selectedPath, path)]]" title$="[[resourceTitle]]" id="resource">
      <paper-icon-button class="toggle-button" icon="arc:arrow-drop-down" on-tap="toggle"></paper-icon-button>
      <span class="resource-name">[[_getName(resource)]]</span>
      <paper-icon-button class="enter-button" icon="arc:chevron-right" hidden$="[[!narrow]]" on-tap="_enterResource"></paper-icon-button>
    </paper-item>
    <iron-collapse id="collapse" opened="[[opened]]">
      <div class="children">
        <template is="dom-repeat" items="[[resource.methods]]">
          <paper-item data-path$="[[path]].methods.[[index]]" on-tap="_selectPath" class$="method-name-item [[_computeItemSelectableClass(selectedPath, path, index)]]" title$="[[item.method]] [[item.description]]">
            <span class="indentable-content method-description">
              <span class$="[[_computeMethodClass(item.method)]]">[[item.method]]</span>
            <span class="method-display">[[item.displayName]]</span>
            </span>
          </paper-item>
        </template>
        <template is="dom-repeat" items="[[resource.resources]]">
          <raml-resource-tree-item indent="[[_computeIndent(indent)]]" indent-size="24" selected-path="[[selectedPath]]" resource="[[item]]" path="[[path]].resources.[[index]]" narrow="[[narrow]]"></raml-resource-tree-item>
        </template>
      </div>
    </iron-collapse>
    <path-selector-resource resource-name="[[_getName(resource)]]" resources="[[resource.resources]]" methods="[[resource.methods]]" selected-path="[[selectedPath]]" items-opened="[[opened]]" path="[[path]]"></path-selector-resource>
  </template>
  <script>Polymer({is:"raml-resource-tree-item",behaviors:[RamlBehaviors.RamlTreeItemBehavior,Polymer.IronA11yKeysBehavior],properties:{resource:Object,opened:{type:Boolean,value:!1,reflectToAttribute:!0},resourceTitle:{type:String,computed:"_computeResourceTitle(resource.*)"},methodIsSelected:{type:Boolean,value:!1,computed:"_computeIsSelectedMethod(isSelected, selectedPath, path, _isReady)"},_isReady:{type:Boolean,value:!1},narrow:{type:Boolean,reflectToAttribute:!0,value:!1}},observers:["_isSelectedChanged(isSelected, methodIsSelected, _isReady)","_openedChanged(opened)"],listeners:{"opened-changed":"_openedHandler","raml-path-selector-nav-back":"_onNarrowPageBack"},keyBindings:{left:"_onLeftKey",right:"_onRightKey"},ready:function(){this._isReady=!0},_getName:function(e){return e.displayName||e.relativeUri},_getMethodName:function(e){return e.displayName||e.method.toUpperCase()},toggle:function(e){e.preventDefault(),e.stopPropagation(),this.opened=!this.opened},_computeResourceTitle:function(){var e=this.resource;if(!e||!e.relativeUri)return"";var t=e.relativeUri;return e.description&&(t+=": "+e.description),t},_isSelectedChanged:function(e,t,o){(e||t)&&o?(this.setAttribute("tabindex","0"),this.scrollElementIntoView(),this.opened||this.set("opened",!0),this.focus()):this.setAttribute("tabindex","-1")},_computeIsSelectedMethod:function(e,t,o,n){return!!(e!==!0&&t&&o&&n)&&0===t.indexOf(o+".methods.")},_openedChanged:function(e){e&&this.fire("opened-changed",{value:!0})},_openedHandler:function(e){e.target!==this&&e.detail.value&&(this.opened=!0)},_onLeftKey:function(e){this.isSelected&&(this.opened=!1,e.detail.keyboardEvent.preventDefault())},_onRightKey:function(e){this.isSelected&&(this.opened=!0,e.detail.keyboardEvent.preventDefault())},_computeIndent:function(e){return e=Number(e),e!==e&&(e=0),++e},_computeMethodClass:function(e){if(e){e=e.toLowerCase();var t="method ";switch(e){case"get":case"post":case"put":case"delete":case"patch":t+=e}return t}},_enterResource:function(e){e.preventDefault(),e.stopPropagation();var t=this.$$("path-selector-resource");t.opened=!0},_onNarrowPageBack:function(e){e.preventDefault(),e.stopPropagation();var t=this.$$("path-selector-resource");t.opened=!1}});</script>
</dom-module>
</body></html>