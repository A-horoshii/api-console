<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-progress/paper-progress.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../error-message/error-message.html">
<link rel="import" href="prism-import.html">
<link rel="import" href="prism-styles.html">

</head><body><dom-module id="prism-highlight">
  <template>
    <style include="prism-styles">
     :host {
      display: block;
      @apply(--prism-highlight);
    }

    pre {
      -webkit-user-select: text;
      margin: 8px;
      @apply(--prism-highlight-code);
    }

    paper-progress {
      width: 100%;
    }

    .arc-search-mark.selected {
      background-color: var(--prism-highlight-mark-selected, #ff9632);
    }
    </style>
    <pre class="parsed-content"><code id="output" class="language-" on-tap="_handleLinks"></code></pre>
    <div hidden$="[[!hasMore]]">
      <paper-button raised="" on-tap="_loadNext">Show next [[maxRead]] lines</paper-button>
      <paper-button raised="" on-tap="_loadAll">Display all</paper-button>
    </div>
    <paper-progress indeterminate="" hidden$="[[!working]]"></paper-progress>
  </template>
  <script>!function(){"use strict";var e="";!function(){var t;if(window.currentImport&&window.currentImport.URL?(t=window.currentImport.URL,window.currentImport._URL&&(t=window.currentImport._URL)):t=window.currentImport._URL?window.currentImport._URL:window.location.href,"about:blank"===t)e="../";else{var r=t.substr(t.indexOf("/",8));r=r.substr(0,r.lastIndexOf("/")+1),r.indexOf("/test")===-1&&r.indexOf("/demo")===-1||(r=r.substr(0,r.length-1),r=r.substr(0,r.lastIndexOf("/")+1)),e=r}}(),Polymer({is:"prism-highlight",properties:{code:String,lang:String,tokenized:{type:Array,readOnly:!0},hasMore:{type:Boolean,readOnly:!0,computed:"_computeHasMore(tokenized)"},maxRead:{type:Number,value:500},working:{type:Boolean,value:!1,readOnly:!0},textSearch:{type:HTMLElement,value:function(){return this.$.output}},importLocation:{type:String,value:function(){return e}}},observers:["_highlight(code, lang)"],detached:function(){this.worker&&(this.worker.terminate(),this.worker.onmessage=null,this.worker.onerror=null,this.worker=null)},reset:function(){this._setTokenized(void 0),this._setWorking(!1),this.$.output.innerHTML=""},_highlight:function(){this.reset(),this.debounce("_highlight",function(){var e={language:this.lang,code:this.code,payload:"tokenize"};this._runWorker(e)},10)},_runWorker:function(e){return this._setWorking(!0),this.worker?void this.worker.postMessage(e):(this.worker=new Worker(this.importLocation+"workers/prism-worker.js"),this.worker.onmessage=this._onWorkerData.bind(this),this.worker.onerror=this._onWorkerError.bind(this),void this.worker.postMessage(e))},_onWorkerData:function(e){switch(this._setWorking(!1),e.data.payload){case"tokenize":this._onTokenized(e.data.tokens);break;case"stringify":this._display(e.data.html)}},_onWorkerError:function(e){this._setWorking(!1);var t="<error-message><p>"+e.message+"</p></error-message>";this._display(t),this.fire("app-log",{message:e,level:"error"}),console.error("Hightligt worker error",e)},_onTokenized:function(e){this._setTokenized(e),this._loadNext()},_loadNext:function(){if(this.tokenized&&0!==this.tokenized.length){var e=this.splice("tokenized",0,this.maxRead),t={tokens:e,payload:"stringify"};this._runWorker(t),0===this.tokenized.length&&this._setTokenized(void 0)}},_loadAll:function(){var e=this.tokenized;this._setTokenized(void 0);var t={tokens:e,payload:"stringify"};this._runWorker(t)},_display:function(e){this.$.output.innerHTML+=e},_computeHasMore:function(e){return!(!e||0===e.length)},_handleLinks:function(e){var t=e.target;if("A"===t.nodeName){e.preventDefault();var r=t.href;this.fire("url-change-action",{url:r})}}})}();</script>
</dom-module>
</body></html>