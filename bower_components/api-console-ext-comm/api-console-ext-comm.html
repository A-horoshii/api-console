<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../fetch-polyfill/fetch-polyfill.html">

<script>Polymer({is:"api-console-ext-comm",properties:{extension:{type:Boolean,value:!1,notify:!0,readOnly:!0},_lastestRequestData:Object},attached:function(){this.listen(window,"message","_messsageHandler"),this.listen(document.body,"api-console-request","_requestHandler")},detached:function(){this.unlisten(window,"message","_messsageHandler"),this.unlisten(document.body,"api-console-request","_requestHandler")},_messsageHandler:function(e){if(e.source===window){var s=e.data;if(s["api-console-extension"]){var t=s["api-console-payload"];switch(t){case"init":this._extensionDetected();break;case"api-console-response":this._responseReady(s["api-console-data"])}}}},_extensionDetected:function(){this._setExtension(!0),this.fire("api-console-extension-installed")},_requestHandler:function(e){this.extension&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this._lastestRequestData=e.detail,window.postMessage({payload:"api-console-request",detail:e.detail},location.origin))},_responseReady:function(e){var s=e?e.data.responseData:void 0,t=this._createRequest(this._lastestRequestData);this._lastestRequestData=void 0;var a=this._createResponse(s),n={request:t,response:a,loadingTime:e?e.data.stats.loadingTime:0,isXhr:!0};s.error?n.error=new Error(s.message):a.ok||(n.error=new Error("Resource is unavailable"));var r=new CustomEvent("api-console-response",{cancelable:!1,bubbles:!0,composed:!0,detail:n});this.dispatchEvent(r)},_createRequest:function(e){var s={method:e.method,mode:"cors"};return e.headers&&(s.headers=this._createHeaders(e.headers)),["GET","HEAD"].indexOf(e.method)!==-1?e.payload=void 0:e.payload&&(s.body=e.payload),new Request(e.url,s)},_createResponse:function(e){if(!e||e.error)return Response.error();if(!e.status||e.status<200)return Response.error();var s={status:e.status,statusText:e.statusText};e.headers&&(s.headers=this._createHeaders(e.headers));try{return new Response(e.response,s)}catch(e){return Response.error()}},_createHeaders:function(e){if(!e)return new Headers;var s=new Headers,t=e.split("\n").map(function(e){var s=e.split(":"),t=s[0],a=s[1];return t=t?t.trim():null,a=a?a.trim():null,t&&a?{name:t,value:a}:null}).filter(function(e){return!!e});return t.forEach(function(e){s.append(e.name,e.value)}),s}});</script>
</head><body></body></html>