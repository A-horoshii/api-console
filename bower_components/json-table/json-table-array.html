<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../arc-icons/arc-icons.html">

<link rel="import" href="json-table-behavior.html">
<link rel="import" href="json-table-object.html">
<link rel="import" href="json-table-primitive-teaser.html">

</head><body><dom-module id="json-table-array">
  <template>
    <style>
     :host {
      display: block;

      --table-actions-label-color: rgba(0, 0, 0, 0.74);
      --table-actions-label-font-size: 13px;

      --paper-dropdown-menu: {
        width: 70px;
      };

      --paper-dropdown-menu-input: {
        text-align: right;
      };

      --paper-input-container-underline: {
        border-bottom-color: transparent;
      };

      --paper-input-container-underline-focus: {
        border-bottom-color: transparent;
      };
    }

    paper-dropdown-menu {
      --paper-input-container-input: {
        @apply(--arc-font-body1);
        color: var(--table-actions-label-color);
        font-size: var(--table-actions-label-font-size);
      };
    }

    table {
      border-collapse: collapse;
    }

    th {
      white-space: nowrap;
      text-align: left;
      padding: 8px 12px;
      @apply(--arc-font-body);
      font-size: 13px;
      color: var(--json-table-array-header-color, --anypoint-color-steel2);
      border-bottom: 1px rgba(0,0,0,0.12) solid;
    }

    td {
      min-width: 60px;
      padding: 8px 12px;
      word-break: normal;
      vertical-align: top;
      border-bottom: 1px rgba(0,0,0,0.12) solid;
      @apply(--arc-font-body);
      font-size: 14px;
      color: var(--json-table-array-body-color, --anypoint-color-steel5);
    }

    *[hidden] {
      display: none;
    }

    .enum-value {
      display: block;
    }

    .enum-value::after {
      content: ',';
      color: rgba(0, 0, 0, 0.54);
    }

    .enum-value:last-of-type::after {
      content: ''
    }

    .toggle-view {
      font-size: inherit;
      color: inherit;
      margin-top: 12px;
      display: block;
      white-space: nowrap;
    }

    .toggle-view.active {
      display: inline-block;
      margin-top: 0;
    }

    .table-actions {
      height: 56px;
      @apply(--layout-horizontal);
      /*@apply(--layout-end-justified);*/
      @apply(--layout-center);
      @apply(--arc-font-body1);
      font-size: var(--table-actions-label-font-size);
      color: var(--table-actions-label-color);
    }

    .page-items-count-selector,
    .page-count {
      margin-right: 32px;
      @apply(--layout-horizontal);
      @apply(--layout-center);
    }
    </style>
    <template is="dom-if" if="[[paginate]]">
      <div class="table-actions">
        <div class="page-items-count-selector">
          <span class="page-items-count-label">Items per page</span>
          <paper-dropdown-menu no-label-float="">
            <paper-listbox class="dropdown-content" attr-for-selected="data-value" selected="{{itemsPerPage}}">
              <paper-item data-value="10">10</paper-item>
              <paper-item data-value="15">15</paper-item>
              <paper-item data-value="20">20</paper-item>
              <paper-item data-value="25">25</paper-item>
              <paper-item data-value="50">50</paper-item>
              <paper-item data-value="100">100</paper-item>
            </paper-listbox>
          </paper-dropdown-menu>
        </div>
        <div class="page-count">
          [[startItemLabel]]-[[endItemLabel]] of [[maxItemsLabel]]
        </div>
        <div class="page-paginators">
          <paper-icon-button icon="arc:chevron-left" on-tap="previousPage" disabled="[[_isDisabedPrevious(page)]]"></paper-icon-button>
          <paper-icon-button icon="arc:chevron-right" on-tap="nextPage" disabled="[[_isDisabedNext(maxItemsLabel, endItemLabel)]]"></paper-icon-button>
        </div>
      </div>
    </template>
    <table>
      <template is="dom-if" if="[[hasColumns]]">
        <thead>
          <tr>
            <template is="dom-repeat" items="[[columns]]">
              <th>[[item]]</th>
            </template>
          </tr>
        </thead>
      </template>
      <tbody>
        <template is="dom-repeat" items="[[display]]" as="displayItem" initial-count="10">
          <tr>
            <template is="dom-repeat" items="[[columns]]" as="column">
              <td>
                <template is="dom-if" if="[[_isPrimitive(displayItem, column)]]" restamp="true">
                  <json-table-primitive-teaser class="primitive-value">[[_getValue(displayItem, column)]]</json-table-primitive-teaser>
                </template>
                <template is="dom-if" if="[[_isObject(displayItem, column)]]" restamp="true">
                  <span class="object-info"><span class="object-label" object="">Object</span> <a href="#" class="toggle-view" data-target="object" on-tap="_toggleItem">show object</a></span>
                  <template is="dom-if" if="[[false]]" object="">
                    <json-table-object json="[[_getValue(displayItem, column)]]" paginate="[[paginate]]" page="[[page]]" items-per-page="[[itemsPerPage]]"></json-table-object>
                  </template>
                </template>
                <template is="dom-if" if="[[_isEnum(displayItem, column)]]">
                  <template is="dom-repeat" items="[[_getValue(displayItem, column)]]">
                    <span class="enum-value">[[item]]</span>
                  </template>
                </template>
                <template is="dom-if" if="[[_isArray(displayItem, column)]]" restamp="true">
                  <span class="object-info"><span class="object-label" array="">Array ([[_computeValueSize(displayItem, column)]])</span> <a href="#" class="toggle-view" data-target="array" on-tap="_toggleItem">show array</a></span>
                  <template is="dom-if" if="[[false]]" array="">
                    <json-table-array json="[[_getValue(displayItem, column)]]" paginate="[[paginate]]" page="[[page]]" items-per-page="[[itemsPerPage]]"></json-table-array>
                  </template>
                </template>
              </td>
            </template>
          </tr>
        </template>
      </tbody>
    </table>
    <template is="dom-if" if="[[paginate]]">
      <div class="table-actions">
        <div class="page-items-count-selector">
          <span class="page-items-count-label">Items per page</span>
          <paper-dropdown-menu no-label-float="">
            <paper-listbox class="dropdown-content" attr-for-selected="data-value" selected="{{itemsPerPage}}">
              <paper-item data-value="10">10</paper-item>
              <paper-item data-value="15">15</paper-item>
              <paper-item data-value="20">20</paper-item>
              <paper-item data-value="25">25</paper-item>
              <paper-item data-value="50">50</paper-item>
              <paper-item data-value="100">100</paper-item>
            </paper-listbox>
          </paper-dropdown-menu>
        </div>
        <div class="page-count">
          [[startItemLabel]]-[[endItemLabel]] of [[maxItemsLabel]]
        </div>
        <div class="page-paginators">
          <paper-icon-button icon="arc:chevron-left" on-tap="previousPage" disabled="[[_isDisabedPrevious(page)]]"></paper-icon-button>
          <paper-icon-button icon="arc:chevron-right" on-tap="nextPage" disabled="[[_isDisabedNext(maxItemsLabel, endItemLabel)]]"></paper-icon-button>
        </div>
      </div>
    </template>
  </template>
  <script>Polymer({is:"json-table-array",behaviors:[ArcBehaviors.JsonTableBehavior],properties:{json:{type:Array,observer:"_jsonChanged"},columns:{type:Array,readOnly:!0,observer:"_columnsChanged"},hasColumns:{type:Boolean,value:!1,readOnly:!0},display:{type:Array,readOnly:!0},startItemLabel:{type:Number,readOnly:!0},endItemLabel:{type:Number,readOnly:!0},maxItemsLabel:{type:Number,readOnly:!0}},observers:["_computeDisplay(json, paginate, page, itemsPerPage)"],_jsonChanged:function(e){if(!e)return this._setDisplay(void 0),void this._setColumns(void 0);var t=this._computeColumns(e);this._setColumns(t)},_computeDisplay:function(e,t,i,a){if(e){var r=e.length-1;if(-1!==r){if(r<=a&&this.paginate)return this.set("paginate",!1);var n=t?i*a:0;if(!(r<n)){for(var s=t?Math.min(n+a-1,r):r,u=[],l=n;l<=s;l++)u.push(this.getItemModel(e[l]));this._setDisplay(u),this._setStartItemLabel(n+1),this._setEndItemLabel(Math.min(s+1,r)),this._setMaxItemsLabel(r)}}}},_computeColumns:function(e){if(!this.isEnum(e)){var t=[];return e.forEach(function(e){if(this.isObject(e))for(var i=Object.keys(e),a=0,r=i.length;a<r;a++)-1===t.indexOf(i[a])&&t.push(i[a])},this),t.length?t:void 0}},_columnsChanged:function(e){e&&e.length?this._setHasColumns(!0):this._setHasColumns(!1)},_isPrimitive:function(e,t){if(!e||!e.value||!t)return!1;if(!(t in e.value))return!1;var i=e.value[t];return this.isPrimitive(i)},_isObject:function(e,t){if(!e||!e.value||!t)return!1;if(!(t in e.value))return!1;var i=e.value[t];return this.isObject(i)},_isEnum:function(e,t){if(!e||!e.value||!t)return!1;if(!(t in e.value))return!1;var i=e.value[t];return this.isArray(i)&&this.isEnum(i)},_isArray:function(e,t){if(!e||!e.value||!t)return!1;if(!(t in e.value))return!1;var i=e.value[t];return this.isArray(i)&&!this.isEnum(i)},_getValue:function(e,t){if(e&&e.value&&t&&t in e.value)return e.value[t]},_toggleItem:function(e){e.preventDefault();var t;e=Polymer.dom(e);for(var i=e.localTarget,a=e.localTarget,r=i.dataset.target;;){if("TD"===i.nodeName){t=i;break}if(!(i=i.parentElement))throw new Error("Couldn't find table cell in the event path.")}var n=t.querySelector("template["+r+"]"),s=t.querySelector(".object-label["+r+"]");n.if=!n.if,n.if?(e.localTarget.textContent="hide "+r,s.setAttribute("hidden",!0),a.classList.add("active")):(e.localTarget.textContent="show "+r,s.removeAttribute("hidden"),a.classList.remove("active"))},nextPage:function(){if(this.maxItemsLabel<=this.endItemLabel)return!1;this.page++},previousPage:function(){this.paginate&&0!==this.page&&this.page--},_isDisabedPrevious:function(e){return 0===e},_isDisabedNext:function(e,t){return e<=t},_computeValueSize:function(e,t){var i=this._getValue(e,t);return i&&i.length||0}});</script>
</dom-module>
</body></html>