<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../arc-icons/arc-icons.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../response-raw-viewer/response-raw-viewer.html">
<link rel="import" href="../xml-viewer/xml-viewer.html">
<link rel="import" href="../json-viewer/json-viewer.html">
<link rel="import" href="../response-highlighter/response-highlighter.html">
<link rel="import" href="../clipboard-copy/clipboard-copy.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-toast/paper-toast.html">
<link rel="import" href="../json-table/json-table.html">


</head><body><dom-module id="response-body-view">
  <template>
    <style>
     :host {
      display: block;
      position: relative;
    }

    #webView {
      width: 100%;
      height: 100%;
      background-color: #fff;
      border: 0;
      margin-top: 12px;
    }

    #saveDialog {
      min-width: 320px;
    }

    .donnload-section {
      @apply(--layout-vertical);
      @apply(--layout-center);
    }

    .download-file-icon {
      width: 64px;
      height: 64px;
      color: var(--response-body-view-download-icon, --accent-color);
    }

    paper-icon-button[active] {
      background-color: var(--response-raw-viewer-button-active, #BDBDBD);
    }
    </style>
    <iron-pages selected="{{activeView}}" hidden$="[[contentPreview]]">
      <section>
        <response-raw-viewer response-text="[[_raw]]" wrap-text$="[[rawTextWrap]]">
          <paper-icon-button content-action="" title="Copy content to clipboard" icon="arc:content-copy" on-tap="_copyToClipboard"></paper-icon-button>
          <paper-icon-button content-action="" title="Save content to file" icon="arc:archive" on-tap="_saveFile"></paper-icon-button>
          <paper-icon-button content-action="" title="View with highlighted syntax" icon="arc:code" toggles="" active="" on-tap="toggleViewSource"></paper-icon-button>
          <paper-icon-button content-action="" title="Preview response" icon="arc:visibility" toggles="" active="{{contentPreview}}"></paper-icon-button>
          <paper-icon-button content-action="" title="Wrap or unwrap text" icon="arc:wrap-text" toggles="" active="{{rawTextWrap}}"></paper-icon-button>
        </response-raw-viewer>
      </section>
      <section>
        <template is="dom-if" if="[[isParsed]]" restamp="true">
          <response-highlighter response-text="[[_raw]]" content-type="[[contentType]]">
            <paper-icon-button content-action="" title="Copy content to clipboard" icon="arc:content-copy" on-tap="_copyToClipboard"></paper-icon-button>
            <paper-icon-button content-action="" title="Save content to file" icon="arc:archive" on-tap="_saveFile"></paper-icon-button>
            <paper-icon-button content-action="" title="View raw response (without syntax highlighting)" icon="arc:code" on-tap="toggleViewSource"></paper-icon-button>
            <paper-icon-button content-action="" title="Preview response" icon="arc:visibility" toggles="" active="{{contentPreview}}"></paper-icon-button>
          </response-highlighter>
        </template>
      </section>
      <section>
        <template is="dom-if" if="[[isJson]]" restamp="true">
          <json-viewer json="[[_raw]]">
            <paper-icon-button content-action="" title="Copy content to clipboard" icon="arc:content-copy" on-tap="_copyToClipboard"></paper-icon-button>
            <paper-icon-button content-action="" title="Save content to file" icon="arc:archive" on-tap="_saveFile"></paper-icon-button>
            <paper-icon-button content-action="" title="View raw response (without syntax highlighting)" icon="arc:code" on-tap="toggleViewSource"></paper-icon-button>
            <paper-icon-button content-action="" title="View in a structured table" icon="arc:view-column" on-tap="toggleViewJsonTabble"></paper-icon-button>
          </json-viewer>
        </template>
      </section>
      <section>
        <template is="dom-if" if="[[isXml]]" restamp="true">
          <xml-viewer xml="[[_raw]]">
            <paper-icon-button content-action="" title="Copy content to clipboard" icon="arc:content-copy" on-tap="_copyToClipboard"></paper-icon-button>
            <paper-icon-button content-action="" title="Save content to file" icon="arc:archive" on-tap="_saveFile"></paper-icon-button>
            <paper-icon-button content-action="" title="View raw response (without syntax highlighting)" icon="arc:code" on-tap="toggleViewSource"></paper-icon-button>
          </xml-viewer>
        </template>
      </section>
      <section>
        <template is="dom-if" if="[[isJsonTable]]">
          <json-table json="[[_raw]]">
            <paper-icon-button content-action="" title="Copy content to clipboard" icon="arc:content-copy" on-tap="_copyToClipboard"></paper-icon-button>
            <paper-icon-button content-action="" title="Save content to file" icon="arc:archive" on-tap="_saveFile"></paper-icon-button>
            <paper-icon-button content-action="" title="View raw response (without syntax highlighting)" icon="arc:code" on-tap="toggleViewSource"></paper-icon-button>
            <paper-icon-button content-action="" title="View in a structured table" icon="arc:view-column" on-tap="toggleViewJsonTabble" toggles="" active=""></paper-icon-button>
          </json-table>
        </template>
      </section>
    </iron-pages>
    <iframe id="webView" hidden$="[[!contentPreview]]"></iframe>
    <paper-dialog id="saveDialog" on-iron-overlay-closed="_downloadDialogClose">
      <h2>Save to file</h2>
      <div>
        <p>Your file is ready to download. Click the icon below to save it to your local drive.</p>
        <div class="donnload-section">
          <a href$="[[downloadFileUrl]]" download$="[[downloadFileName]]" on-tap="_downloadIconTap" target="_blank">
            <paper-icon-button icon="arc:file-download" class="download-file-icon" title="Download file"></paper-icon-button>
          </a>
        </div>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss="" autofocus="">Close</paper-button>
      </div>
    </paper-dialog>
    <clipboard-copy content="[[_raw]]"></clipboard-copy>
    <paper-toast id="safariDownload" text="Safari doesn't support file download. Please, use other browser."></paper-toast>
  </template>
  <script>!function(){"use strict";window.URL=URL||webkitURL;var e="";!function(){var t;if(window.currentImport&&window.currentImport.URL?(t=window.currentImport.URL,window.currentImport._URL&&(t=window.currentImport._URL)):t=window.currentImport._URL?window.currentImport._URL:window.location.href,"about:blank"===t)e="../";else{var i=t.substr(t.indexOf("/",8));i=i.substr(0,i.lastIndexOf("/")+1),-1===i.indexOf("/test")&&-1===i.indexOf("/demo")||(i=i.substr(0,i.length-1),i=i.substr(0,i.lastIndexOf("/")+1)),e=i}}(),Polymer({is:"response-body-view",properties:{responseText:{type:String,observer:"_responseTextChanged"},_raw:String,contentType:String,contentPreview:{type:Boolean,value:!1,observer:"_contentPreviewChanged"},isParsed:{type:Boolean,value:!1,readOnly:!0},isJson:{type:Boolean,value:!1,readOnly:!0},isXml:{type:Boolean,value:!1,readOnly:!0},activeView:Number,downloadFileUrl:{type:String,readOnly:!0},downloadFileName:{type:String,readOnly:!0},rawTextWrap:Boolean,importLocation:{type:String,value:function(){return e}},isSafari:{type:Boolean,value:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},readOnly:!0},isJsonTable:{type:Boolean,readOnly:!0}},observers:["_contentTypeChanged(contentType, _raw)"],attached:function(){this.listen(window,"message","_onExternalMessage"),this.$.webView.src=this.importLocation+"html-preview.html"},detached:function(){this.unlisten(window,"message","_onExternalMessage")},_responseTextChanged:function(e){return this._setIsXml(!1),this._setIsJson(!1),this._setIsParsed(!1),void 0===e?this.set("_raw",void 0):null===e||!1===e?this.set("_raw",e):(this.set("_raw",void 0),void(e&&this.debounce("set-raw",function(){this.set("_raw",this.responseText)},1)))},_contentTypeChanged:function(e){var t=!1,i=!1,n=!1;this.contentPreview=!1,e&&(-1!==e.indexOf("xml")?(this.activeView=3,n=!0):-1!==e.indexOf("json")?(this.activeView=2,i=!0):(this.activeView=1,t=!0)),this._setIsXml(n),this._setIsJson(i),this._setIsParsed(t)},_contentPreviewChanged:function(e){this.isAttached&&(e?this._openResponsePreview():this._closeResponsePreview())},_openResponsePreview:function(){this.isAttached&&this.$.webView.contentWindow.postMessage({rawResponse:this._raw},"*")},_closeResponsePreview:function(){this.isAttached&&this.$.webView.contentWindow.postMessage({cleanUp:!0},"*")},_onExternalMessage:function(e){if(this.isAttached&&e&&e.data)if("preview-window-height"in e.data){var t=e.data["preview-window-height"];this.$.webView.style.height=t?e.data["preview-window-height"]+"px":"auto"}else e.data["preview-window-close"]&&(this.contentPreview=!1)},_copyToClipboard:function(e){var t=Polymer.dom(e).localTarget;this.$$("clipboard-copy").copy()?t.icon="arc:done":t.icon="arc:error",this.async(function(){this._resetCopyButtonState(t)},1e3)},_resetCopyButtonState:function(e){e.icon="arc:content-copy"},_saveFile:function(){this.fire("save-content-to-file",{content:this._raw},{cancelable:!0}).defaultPrevented||(this.isSafari?this.$.safariDownload.opened=!0:this.saveToFile())},saveToFile:function(){var e=".";this.isJson?e+="json":this.isXml?e+="xml":e+="txt";var t=this.contentType||"text/plain",i=new Blob([this._raw],{type:t}),n="response-"+(new Date).toISOString()+e;this._setDownloadFileUrl(URL.createObjectURL(i)),this._setDownloadFileName(n),this.$.saveDialog.opened=!0},_downloadIconTap:function(){this.async(function(){this.$.saveDialog.opened=!1},250)},_downloadDialogClose:function(){URL.revokeObjectURL(this.downloadFileUrl),this._setDownloadFileUrl(void 0),this._setDownloadFileName(void 0)},toggleViewSource:function(){this.__parsedView?(this.activeView=this.__parsedView,this.__parsedView=void 0,2===this.activeView&&this.isJsonTable&&this._setIsJsonTable(!1)):(this.__parsedView=this.activeView,this.activeView=0)},toggleViewJsonTabble:function(){this.isJsonTable?(this.activeView=2,this._setIsJsonTable(!1)):(this.activeView=4,this._setIsJsonTable(!0))}})}();</script>
</dom-module>
</body></html>