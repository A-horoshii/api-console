<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../arc-icons/arc-icons.html">
<link rel="import" href="simple-type-editor.html">
<link rel="import" href="body-json-editor-behavior.html">

</head><body><dom-module id="object-editor">
  <template>
    <style>
     :host {
      display: block;

      @apply(--body-json-object-editor);
      --paper-input-container-color: rgba(0, 0, 0, 0.24);
      --paper-dropdown-menu-input: {
        color: #673AB7;
      }
      --paper-dropdown-menu-button: {
        color: #673AB7;
      }
    }

    .indent {
      margin-left: 12px;
    }

    .action-button {
      color: var(--primary-color);
    }

    </style>
    <template is="dom-if" if="[[_typeIs(value.type, 'object')]]">
      <simple-type-editor value="{{value}}"></simple-type-editor>
      <template is="dom-repeat" items="{{value.properties}}" id="object">
        <object-editor narrow="[[narrow]]" class="indent" value="{{item}}" schema="[[subPropertySchema]]"></object-editor>
      </template>
      <div class="indent add-action">
        <paper-button class="action-button" on-tap="_appendProperty">add subproperty</paper-button>
      </div>
    </template>
    <template is="dom-if" if="[[_typeIs(value.type, 'array')]]">
      <simple-type-editor value="{{value}}"></simple-type-editor>
      <template is="dom-repeat" items="{{value.items}}" id="array">
        <object-editor narrow="[[narrow]]" class="indent" no-key="" value="{{item}}" schema="[[subPropertySchema]]" is-array-item="" allowed-types="[[allowedTypes]]"></object-editor>
      </template>
      <div class="indent add-action">
        <paper-button class="action-button" on-tap="_appendProperty">add array item</paper-button>
      </div>
    </template>
    <template is="dom-if" if="[[!_typeIs(value.type, 'array', 'object')]]">
      <simple-type-editor narrow="[[narrow]]" value="{{value}}" no-key="[[noKey]]" schema="[[schema]]" allowed-types="[[allowedTypes]]"></simple-type-editor>
    </template>
  </template>
  <script>Polymer({is:"object-editor",behaviors:[ArcBehaviors.BodyJsonEditorBehavior],properties:{noKey:{type:Boolean},value:{type:Object,notify:!0},isArrayItem:{type:Boolean,value:!1}},observers:["_schemaChanged(schema.*)","_computeChildTypes(isArrayItem, schema.*)"],listeners:{"remove-property":"_onRemoveProperty"},_onRemoveProperty:function(e){var t=this.value;if(t&&["object","array"].indexOf(t.type)!==-1){var i;if(i="object"===this.value.type?this.$$("#object"):this.$$("#array"),!i)return;var s=i.indexForElement(e.target);if(s===-1||void 0===s)return;"object"===this.value.type?this.splice("value.properties",s,1):this.splice("value.items",s,1),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()}},_appendProperty:function(){var e={name:"",type:""};if("object"===this.value.type)this.value.properties?this.push("value.properties",e):this.set("value.properties",[e]);else if(this.value.items&&this.value.items.length){var t=this.value.items[this.value.items.length-1].type;e.type=t,this.push("value.items",e)}else this.set("value.items",[e])},_computeChildTypes:function(e,t){if(e){var i=t.base;if(!i||!i.length)return void this.set("allowedTypes",null);var s=[];i.forEach(function(e){e.type&&s.indexOf(e.type)===-1&&(s[s.length]=e.type)}),this.set("allowedTypes",s)}}});</script>
</dom-module>
</body></html>