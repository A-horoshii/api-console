<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-progress/paper-progress.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../date-time/date-time.html">


</head><body><dom-module id="request-timings">
  <template>
    <style>
     :host {
      display: block;
      --paper-progress-height: var(--request-timings-progress-height, 12px);
      --paper-progress-container-color: var(--request-timings-progress-background, #F5F5F5);
      --paper-progress-active-color: var(--request-timings-progress-background, #F5F5F5);
      --paper-progress-secondary-color: var(--request-timings-progress-color, #4a4);
      @apply(--request-timings);
    }

    .row {
      @apply(--layout-horizontal);
      @apply(--layout-center);
    }

    .flex,
    .timing-chart {
      @apply(--layout-flex);
    }

    .label,
    .date-value {
      @apply(--select-text);
      @apply(--form-label);
    }

    .timing-label {
      width: var(--request-timings-label-width, 160px);
      @apply(--form-label);
    }

    .timing-value {
      width: var(--request-timings-value-width, 120px);
      text-align: right;
      @apply(--select-text);
    }

    paper-progress {
      width: 100%;
    }

    .total {
      margin-top: 12px;
      padding-top: 12px;
      font-weight: 500;
      border-top: 2px var(--paper-grey-200, rgba(255, 0, 0, 0.74)) solid;
    }
    </style>
    <div class="row" hidden$="[[!_hasValue(startTime)]]">
      <div class="flex">
        <span class="label">Start date</span>:
        <date-time year="numeric" month="numeric" day="numeric" hour="numeric" minute="numeric" second="numeric" class="date-value" date="[[startTime]]"></date-time>
      </div>
    </div>
    <div class="row" hidden$="[[!_hasValue(blocked)]]">
      <div class="timing-label label" id="queueing">
        Queueing:
      </div>
      <div class="timing-chart">
        <paper-progress aria-labelledby="queueing" value="0" secondary-progress="[[blocked]]" max="[[fullTime]]" step="0.0001"></paper-progress>
      </div>
      <span class="timing-value">[[_round(blocked)]] ms</span>
    </div>
    <div class="row" hidden$="[[!_hasValue(dns)]]">
      <div class="timing-label label" id="dnsLookup">
        DNS Lookup:
      </div>
      <div class="timing-chart">
        <paper-progress aria-labelledby="dnsLookup" value="[[_computeSum(blocked)]]" secondary-progress="[[_computeSum(blocked, dns)]]" max="[[fullTime]]" step="0.0001"></paper-progress>
      </div>
      <span class="timing-value">[[_round(dns)]] ms</span>
    </div>
    <div class="row">
      <div class="timing-label label" id="ttc">
        Time to connect:
      </div>
      <div class="timing-chart">
        <paper-progress aria-labelledby="ttc" value="[[_computeSum(blocked, dns)]]" secondary-progress="[[_computeSum(blocked, dns, connect)]]" max="[[fullTime]]" step="0.0001"></paper-progress>
      </div>
      <span class="timing-value">[[_round(connect)]] ms</span>
    </div>
    <div class="row" hidden$="[[!_hasValue(ssl)]]">
      <div class="timing-label label" id="ssl">
        SSL negotiation:
      </div>
      <div class="timing-chart">
        <paper-progress aria-labelledby="ssl" secondary-progress="[[_computeSum(blocked, dns, connect, ssl)]]" value="[[_computeSum(blocked, dns, connect)]]" max="[[fullTime]]" step="0.0001"></paper-progress>
      </div>
      <span class="timing-value">[[_round(ssl)]] ms</span>
    </div>
    <div class="row">
      <div class="timing-label label" id="sendTime">
        Send time:
      </div>
      <div class="timing-chart">
        <paper-progress aria-labelledby="sendTime" secondary-progress="[[_computeSum(blocked, dns, connect, ssl, send)]]" value="[[_computeSum(blocked, dns, connect, ssl)]]" max="[[fullTime]]" step="0.0001"></paper-progress>
      </div>
      <span class="timing-value">[[_round(send)]] ms</span>
    </div>
    <div class="row">
      <div class="timing-label label" id="ttfb">
        Wait time (TTFB):
      </div>
      <div class="timing-chart">
        <paper-progress aria-labelledby="ttfb" secondary-progress="[[_computeSum(blocked, dns, connect, send, ssl, wait)]]" value="[[_computeSum(blocked, dns, connect, send, ssl)]]" max="[[fullTime]]" step="0.0001"></paper-progress>
      </div>
      <span class="timing-value">[[_round(wait)]] ms</span>
    </div>
    <div class="row">
      <div class="timing-label label" id="receive">
        Content download:
      </div>
      <div class="timing-chart">
        <paper-progress aria-labelledby="receive" secondary-progress="[[_computeSum(blocked, dns, connect, send, ssl, wait, receive)]]" value="[[_computeSum(blocked, dns, connect, send, ssl, wait)]]" max="[[fullTime]]" step="0.0001"></paper-progress>
      </div>
      <span class="timing-value">[[_round(receive)]] ms</span>
    </div>
    <div class="row">
      <div class="flex"></div>
      <span class="timing-value total">[[_round(fullTime)]] ms</span>
    </div>
  </template>
  <script>Polymer({is:"request-timings",properties:{timings:{type:Object},startTime:{type:String},fullTime:{type:Number,readOnly:!0},connect:{type:Number,readOnly:!0},receive:{type:Number,readOnly:!0},send:{type:Number,readOnly:!0},wait:{type:Number,readOnly:!0},blocked:{type:Number,readOnly:!0},dns:{type:Number,readOnly:!0},ssl:{type:Number,readOnly:!0}},observers:["_update(timings.*)"],ready:function(){this.isReady=!0,this._update()},detached:function(){this.reset()},reset:function(){this._setFullTime(0),this._setConnect(0),this._setReceive(0),this._setSend(0),this._setWait(0),this._setDns(-1),this._setBlocked(-1),this._setSsl(-1),this.startTime=0},_update:function(){if(this.isReady){var e=this.timings||{},t=0,s=Number(e.connect),i=Number(e.receive),r=Number(e.send),n=Number(e.wait),u=Number(e.blocked),a=Number(e.dns),m=Number(e.ssl);(s!==s||s<0)&&(s=0),(i!==i||i<0)&&(i=0),(r!==r||r<0)&&(r=0),(n!==n||n<0)&&(n=0),(a!==a||a<0)&&(a=-1),(u!==u||u<0)&&(u=-1),(m!==m||m<0)&&(m=-1),t+=s+i+r+n,a>0&&(t+=a),u>0&&(t+=u),m>0&&(t+=m),this._setFullTime(t),this._setConnect(s),this._setReceive(i),this._setSend(r),this._setWait(n),this._setDns(a),this._setBlocked(u),this._setSsl(m),e.startTime?this.set("startTime",e.startTime):this.set("startTime",this.startTime||-1)}},_round:function(e,t){return e=Number(e),e!==e?"unknown":(t=+t,0===t?Math.round(e):(t&&t===t||(t=4),t=Math.pow(10,t),Math.round(e*t)/t))},_computeSum:function(){var e=0,t=Array.prototype.slice.call(arguments);return t.forEach(function(t){t=Number(t),t<0||(e+=t)}),e},_hasValue:function(e){return void 0!==e&&("string"==typeof e?!!e:e>0)}});</script>
</dom-module>
</body></html>