goog.provide("cljs.core.async.impl.timers"),goog.require("cljs.core"),goog.require("cljs.core.async.impl.protocols"),goog.require("cljs.core.async.impl.channels"),goog.require("cljs.core.async.impl.dispatch"),cljs.core.async.impl.timers.MAX_LEVEL=15,cljs.core.async.impl.timers.P=.5,cljs.core.async.impl.timers.random_level=function(r){for(var e=[],c=arguments.length,s=0;;){if(!(s<c))break;e.push(arguments[s]);var i=s+1;s=i}var l=e.length;switch(l){case 0:return cljs.core.async.impl.timers.random_level.cljs$core$IFn$_invoke$arity$0();case 1:return cljs.core.async.impl.timers.random_level.cljs$core$IFn$_invoke$arity$1(arguments[0]);default:throw new Error([cljs.core.str("Invalid arity: "),cljs.core.str(e.length)].join(""))}},cljs.core.async.impl.timers.random_level.cljs$core$IFn$_invoke$arity$0=function(){return cljs.core.async.impl.timers.random_level.cljs$core$IFn$_invoke$arity$1(0)},cljs.core.async.impl.timers.random_level.cljs$core$IFn$_invoke$arity$1=function(r){for(;;){if(!(Math.random()<cljs.core.async.impl.timers.P&&r<cljs.core.async.impl.timers.MAX_LEVEL))return r;var e=r+1;r=e}},cljs.core.async.impl.timers.random_level.cljs$lang$maxFixedArity=1,cljs.core.async.impl.timers.SkipListNode=function(r,e,c){this.key=r,this.val=e,this.forward=c,this.cljs$lang$protocol_mask$partition0$=2155872256,this.cljs$lang$protocol_mask$partition1$=0},cljs.core.async.impl.timers.SkipListNode.prototype.cljs$core$ISeqable$_seq$arity$1=function(r){var e=this,c=e.key;return cljs.core._conj(function(){var r=e.val;return cljs.core._conj(cljs.core.List.EMPTY,r)}(),c)},cljs.core.async.impl.timers.SkipListNode.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(r,e,c){var s=this;return cljs.core.pr_sequential_writer(e,cljs.core.pr_writer,"["," ","]",c,s)},cljs.core.async.impl.timers.SkipListNode.getBasis=function(){return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.cst$sym$key,cljs.core.with_meta(cljs.core.cst$sym$val,new cljs.core.PersistentArrayMap(null,1,[cljs.core.cst$kw$mutable,!0],null)),cljs.core.cst$sym$forward],null)},cljs.core.async.impl.timers.SkipListNode.cljs$lang$type=!0,cljs.core.async.impl.timers.SkipListNode.cljs$lang$ctorStr="cljs.core.async.impl.timers/SkipListNode",cljs.core.async.impl.timers.SkipListNode.cljs$lang$ctorPrWriter=function(r,e,c){return cljs.core._write(e,"cljs.core.async.impl.timers/SkipListNode")},cljs.core.async.impl.timers.__GT_SkipListNode=function(r,e,c){return new cljs.core.async.impl.timers.SkipListNode(r,e,c)},cljs.core.async.impl.timers.skip_list_node=function(r){for(var e=[],c=arguments.length,s=0;;){if(!(s<c))break;e.push(arguments[s]);var i=s+1;s=i}var l=e.length;switch(l){case 1:return cljs.core.async.impl.timers.skip_list_node.cljs$core$IFn$_invoke$arity$1(arguments[0]);case 3:return cljs.core.async.impl.timers.skip_list_node.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);default:throw new Error([cljs.core.str("Invalid arity: "),cljs.core.str(e.length)].join(""))}},cljs.core.async.impl.timers.skip_list_node.cljs$core$IFn$_invoke$arity$1=function(r){return cljs.core.async.impl.timers.skip_list_node.cljs$core$IFn$_invoke$arity$3(null,null,r)},cljs.core.async.impl.timers.skip_list_node.cljs$core$IFn$_invoke$arity$3=function(r,e,c){for(var s=new Array(c+1),i=0;;){if(!(i<s.length))break;s[i]=null;var l=i+1;i=l}return new cljs.core.async.impl.timers.SkipListNode(r,e,s)},cljs.core.async.impl.timers.skip_list_node.cljs$lang$maxFixedArity=3,cljs.core.async.impl.timers.least_greater_node=function(r){for(var e=[],c=arguments.length,s=0;;){if(!(s<c))break;e.push(arguments[s]);var i=s+1;s=i}var l=e.length;switch(l){case 3:return cljs.core.async.impl.timers.least_greater_node.cljs$core$IFn$_invoke$arity$3(arguments[0],arguments[1],arguments[2]);case 4:return cljs.core.async.impl.timers.least_greater_node.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw new Error([cljs.core.str("Invalid arity: "),cljs.core.str(e.length)].join(""))}},cljs.core.async.impl.timers.least_greater_node.cljs$core$IFn$_invoke$arity$3=function(r,e,c){return cljs.core.async.impl.timers.least_greater_node.cljs$core$IFn$_invoke$arity$4(r,e,c,null)},cljs.core.async.impl.timers.least_greater_node.cljs$core$IFn$_invoke$arity$4=function(r,e,c,s){for(;;){if(c<0)return r;var i=function(){for(var s=r;;){var i=s.forward[c];if(cljs.core.truth_(i)){var l=i;if(l.key<e){var t=l;s=t;continue}return s}return s}}();null==s||(s[c]=i);var l=i,t=e,n=c-1,o=s;r=l,e=t,c=n,s=o}},cljs.core.async.impl.timers.least_greater_node.cljs$lang$maxFixedArity=4,cljs.core.async.impl.timers.SkipList=function(r,e){this.header=r,this.level=e,this.cljs$lang$protocol_mask$partition0$=2155872256,this.cljs$lang$protocol_mask$partition1$=0},cljs.core.async.impl.timers.SkipList.prototype.put=function(r,e){var c=this,s=new Array(cljs.core.async.impl.timers.MAX_LEVEL),i=cljs.core.async.impl.timers.least_greater_node.cljs$core$IFn$_invoke$arity$4(c.header,r,c.level,s),l=i.forward[0];if(null!=l&&l.key===r)return l.val=e;var t=cljs.core.async.impl.timers.random_level.cljs$core$IFn$_invoke$arity$0();if(t>c.level){for(var n=c.level+1;;){if(!(n<=t+1))break;s[n]=c.header;var o=n+1;n=o}c.level=t}for(var a=cljs.core.async.impl.timers.skip_list_node.cljs$core$IFn$_invoke$arity$3(r,e,new Array(t)),m=0;;){if(m<=c.level){var $=s[m].forward;return a.forward[m]=$[m],$[m]=a}return null}},cljs.core.async.impl.timers.SkipList.prototype.remove=function(r){var e=this,c=new Array(cljs.core.async.impl.timers.MAX_LEVEL),s=cljs.core.async.impl.timers.least_greater_node.cljs$core$IFn$_invoke$arity$4(e.header,r,e.level,c),i=s.forward[0];if(null==i||i.key!==r)return null;for(var l=0;;){if(!(l<=e.level))break;var t=c[l].forward;if(t[l]!==i){var n=l+1;l=n}else{t[l]=i.forward[l];var o=l+1;l=o}}for(;;){if(!(e.level>0&&null==e.header.forward[e.level]))return null;e.level=e.level-1}},cljs.core.async.impl.timers.SkipList.prototype.ceilingEntry=function(r){for(var e=this,c=e.header,s=e.level;;){if(s<0)return c===e.header?null:c;var i=function(){for(var e=c;;){var i=e.forward[s];if(null==i)return null;if(i.key>=r)return i;var l=i;e=l}}();if(null==i){var l=c,t=s-1;c=l,s=t}else{var n=i,o=s-1;c=n,s=o}}},cljs.core.async.impl.timers.SkipList.prototype.floorEntry=function(r){for(var e=this,c=e.header,s=e.level;;){if(s<0)return c===e.header?null:c;var i=function(){for(var e=c;;){var i=e.forward[s];{if(null==i)return 0===s?e:null;if(i.key>r)return e;var l=i;e=l}}}();if(cljs.core.truth_(i)){var l=i,t=s-1;c=l,s=t}else{var n=c,o=s-1;c=n,s=o}}},cljs.core.async.impl.timers.SkipList.prototype.cljs$core$ISeqable$_seq$arity$1=function(r){var e=this,c=this,s=function(r){return function e(c){return new cljs.core.LazySeq(null,function(r){return function(){return null==c?null:cljs.core.cons(new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c.key,c.val],null),e(c.forward[0]))}}(r),null,null)}}(c);return s(e.header.forward[0])},cljs.core.async.impl.timers.SkipList.prototype.cljs$core$IPrintWithWriter$_pr_writer$arity$3=function(r,e,c){var s=this,i=function(r){return function(r){return cljs.core.pr_sequential_writer(e,cljs.core.pr_writer,""," ","",c,r)}}(s);return cljs.core.pr_sequential_writer(e,i,"{",", ","}",c,s)},cljs.core.async.impl.timers.SkipList.getBasis=function(){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.cst$sym$header,cljs.core.with_meta(cljs.core.cst$sym$level,new cljs.core.PersistentArrayMap(null,1,[cljs.core.cst$kw$mutable,!0],null))],null)},cljs.core.async.impl.timers.SkipList.cljs$lang$type=!0,cljs.core.async.impl.timers.SkipList.cljs$lang$ctorStr="cljs.core.async.impl.timers/SkipList",cljs.core.async.impl.timers.SkipList.cljs$lang$ctorPrWriter=function(r,e,c){return cljs.core._write(e,"cljs.core.async.impl.timers/SkipList")},cljs.core.async.impl.timers.__GT_SkipList=function(r,e){return new cljs.core.async.impl.timers.SkipList(r,e)},cljs.core.async.impl.timers.skip_list=function(){return new cljs.core.async.impl.timers.SkipList(cljs.core.async.impl.timers.skip_list_node.cljs$core$IFn$_invoke$arity$1(0),0)},cljs.core.async.impl.timers.timeouts_map=cljs.core.async.impl.timers.skip_list(),cljs.core.async.impl.timers.TIMEOUT_RESOLUTION_MS=10,cljs.core.async.impl.timers.timeout=function(r){var e=(new Date).valueOf()+r,c=cljs.core.async.impl.timers.timeouts_map.ceilingEntry(e),s=cljs.core.truth_(function(){var r=c;return cljs.core.truth_(r)?c.key<e+cljs.core.async.impl.timers.TIMEOUT_RESOLUTION_MS:r}())?c.val:null;if(cljs.core.truth_(s))return s;var i=cljs.core.async.impl.channels.chan.cljs$core$IFn$_invoke$arity$1(null);return cljs.core.async.impl.timers.timeouts_map.put(e,i),cljs.core.async.impl.dispatch.queue_delay(function(r,e,c,s){return function(){return cljs.core.async.impl.timers.timeouts_map.remove(c),cljs.core.async.impl.protocols.close_BANG_(r)}}(i,s,e,c),r),i};