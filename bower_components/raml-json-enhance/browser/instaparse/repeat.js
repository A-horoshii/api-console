goog.provide("instaparse.repeat"),goog.require("cljs.core"),goog.require("instaparse.combinators_source"),goog.require("instaparse.auto_flatten_seq"),goog.require("instaparse.viz"),goog.require("instaparse.gll"),goog.require("instaparse.reduction"),goog.require("instaparse.failure"),instaparse.repeat.empty_result_QMARK_=function(e){return cljs.core.vector_QMARK_(e)&&cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.count(e),1)||cljs.core.map_QMARK_(e)&&cljs.core.contains_QMARK_(e,cljs.core.cst$kw$tag)&&cljs.core.empty_QMARK_(cljs.core.get.cljs$core$IFn$_invoke$arity$2(e,cljs.core.cst$kw$content))||cljs.core.empty_QMARK_(e)},instaparse.repeat.failure_signal=instaparse.gll.__GT_Failure(null,null),instaparse.repeat.get_end=function(e){for(var r=[],t=arguments.length,s=0;;){if(!(s<t))break;r.push(arguments[s]);s=s+1}switch(r.length){case 1:return instaparse.repeat.get_end.cljs$core$IFn$_invoke$arity$1(arguments[0]);case 2:return instaparse.repeat.get_end.cljs$core$IFn$_invoke$arity$2(arguments[0],arguments[1]);default:throw new Error([cljs.core.str("Invalid arity: "),cljs.core.str(r.length)].join(""))}},instaparse.repeat.get_end.cljs$core$IFn$_invoke$arity$1=function(e){var r=instaparse.viz.span(e),t=(cljs.core.nth.cljs$core$IFn$_invoke$arity$3(r,0,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(r,1,null));return cljs.core.truth_(t)?cljs.core.long$(t):cljs.core.count(e)},instaparse.repeat.get_end.cljs$core$IFn$_invoke$arity$2=function(e,r){var t=instaparse.viz.span(e),s=(cljs.core.nth.cljs$core$IFn$_invoke$arity$3(t,0,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(t,1,null));return cljs.core.truth_(s)?cljs.core.long$(s):r+cljs.core.count(e)},instaparse.repeat.get_end.cljs$lang$maxFixedArity=2,instaparse.repeat.parse_from_index=function(e,r,t,s,a){var n=instaparse.gll.make_tramp.cljs$core$IFn$_invoke$arity$3(e,t,s);return instaparse.gll.push_listener(n,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[a,r],null),instaparse.gll.TopListener(n)),instaparse.gll.run.cljs$core$IFn$_invoke$arity$1(n)},instaparse.repeat.select_parse=function(e,r,t,s,a,n){for(var c=cljs.core.count(t),$=cljs.core.seq(n);;){if(!$)return null;var l=cljs.core.first($),i=instaparse.viz.span(l),o=(cljs.core.nth.cljs$core$IFn$_invoke$arity$3(i,0,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(i,1,null)),_=cljs.core.truth_(o)?o:a+cljs.core.count(l);if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(_,c))return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[l,_,null],null);var p=cljs.core.seq(instaparse.repeat.parse_from_index(e,r,t,s,_));if(p){var j=p;return new cljs.core.PersistentVector(null,3,5,cljs.core.PersistentVector.EMPTY_NODE,[l,_,j],null)}$=cljs.core.next($)}},instaparse.repeat.repeat_parse_hiccup=function(e){for(var r=[],t=arguments.length,s=0;;){if(!(s<t))break;r.push(arguments[s]);s=s+1}switch(r.length){case 5:return instaparse.repeat.repeat_parse_hiccup.cljs$core$IFn$_invoke$arity$5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);case 6:return instaparse.repeat.repeat_parse_hiccup.cljs$core$IFn$_invoke$arity$6(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:throw new Error([cljs.core.str("Invalid arity: "),cljs.core.str(r.length)].join(""))}},instaparse.repeat.repeat_parse_hiccup.cljs$core$IFn$_invoke$arity$5=function(e,r,t,s,a){return instaparse.repeat.repeat_parse_hiccup.cljs$core$IFn$_invoke$arity$6(e,r,t,s,a,0)},instaparse.repeat.repeat_parse_hiccup.cljs$core$IFn$_invoke$arity$6=function(e,r,t,s,a,n){for(var c=cljs.core.count(s),$=instaparse.repeat.parse_from_index(e,r,s,a,n),l=cljs.core.long$(n),i=instaparse.auto_flatten_seq.auto_flatten_seq(new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[t],null)),o=instaparse.repeat.select_parse(e,r,s,a,l,$),_=o,p=(cljs.core.nth.cljs$core$IFn$_invoke$arity$3(_,0,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(_,1,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(_,2,null),l),j=i,u=o;;){var k=p,v=j,y=u,f=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(y,0,null),g=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(y,1,null),F=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(y,2,null);if(null==y)return instaparse.repeat.failure_signal;if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(k,g))return instaparse.repeat.failure_signal;if(null==F)return instaparse.gll.safe_with_meta(instaparse.auto_flatten_seq.convert_afs_to_vec(instaparse.auto_flatten_seq.conj_flat(v,f)),new cljs.core.PersistentArrayMap(null,3,[cljs.core.cst$kw$optimize,cljs.core.cst$kw$memory,cljs.core.cst$kw$instaparse$gll_SLASH_start_DASH_index,0,cljs.core.cst$kw$instaparse$gll_SLASH_end_DASH_index,c],null));var I=cljs.core.long$(g),w=instaparse.auto_flatten_seq.conj_flat(v,f),h=instaparse.repeat.select_parse(e,r,s,a,g,F);p=I,j=w,u=h}},instaparse.repeat.repeat_parse_hiccup.cljs$lang$maxFixedArity=6,instaparse.repeat.repeat_parse_enlive=function(e){for(var r=[],t=arguments.length,s=0;;){if(!(s<t))break;r.push(arguments[s]);s=s+1}switch(r.length){case 5:return instaparse.repeat.repeat_parse_enlive.cljs$core$IFn$_invoke$arity$5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);case 6:return instaparse.repeat.repeat_parse_enlive.cljs$core$IFn$_invoke$arity$6(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:throw new Error([cljs.core.str("Invalid arity: "),cljs.core.str(r.length)].join(""))}},instaparse.repeat.repeat_parse_enlive.cljs$core$IFn$_invoke$arity$5=function(e,r,t,s,a){return instaparse.repeat.repeat_parse_enlive.cljs$core$IFn$_invoke$arity$6(e,r,t,s,a,0)},instaparse.repeat.repeat_parse_enlive.cljs$core$IFn$_invoke$arity$6=function(e,r,t,s,a,n){for(var c=cljs.core.count(s),$=instaparse.repeat.parse_from_index(e,r,s,a,n),l=cljs.core.long$(n),i=instaparse.auto_flatten_seq.EMPTY,o=instaparse.repeat.select_parse(e,r,s,a,l,$),_=o,p=(cljs.core.nth.cljs$core$IFn$_invoke$arity$3(_,0,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(_,1,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(_,2,null),l),j=i,u=o;;){var k=p,v=j,y=u,f=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(y,0,null),g=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(y,1,null),F=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(y,2,null);if(null==y)return instaparse.repeat.failure_signal;if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(k,g))return instaparse.repeat.failure_signal;if(null==F)return instaparse.gll.safe_with_meta(new cljs.core.PersistentArrayMap(null,2,[cljs.core.cst$kw$tag,t,cljs.core.cst$kw$content,cljs.core.seq(instaparse.auto_flatten_seq.conj_flat(v,f))],null),new cljs.core.PersistentArrayMap(null,3,[cljs.core.cst$kw$optimize,cljs.core.cst$kw$memory,cljs.core.cst$kw$instaparse$gll_SLASH_start_DASH_index,0,cljs.core.cst$kw$instaparse$gll_SLASH_end_DASH_index,c],null));var I=cljs.core.long$(g),w=instaparse.auto_flatten_seq.conj_flat(v,f),h=instaparse.repeat.select_parse(e,r,s,a,g,F);p=I,j=w,u=h}},instaparse.repeat.repeat_parse_enlive.cljs$lang$maxFixedArity=6,instaparse.repeat.repeat_parse_no_tag=function(e){for(var r=[],t=arguments.length,s=0;;){if(!(s<t))break;r.push(arguments[s]);s=s+1}switch(r.length){case 4:return instaparse.repeat.repeat_parse_no_tag.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return instaparse.repeat.repeat_parse_no_tag.cljs$core$IFn$_invoke$arity$5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw new Error([cljs.core.str("Invalid arity: "),cljs.core.str(r.length)].join(""))}},instaparse.repeat.repeat_parse_no_tag.cljs$core$IFn$_invoke$arity$4=function(e,r,t,s){return instaparse.repeat.repeat_parse_no_tag.cljs$core$IFn$_invoke$arity$5(e,r,t,s,0)},instaparse.repeat.repeat_parse_no_tag.cljs$core$IFn$_invoke$arity$5=function(e,r,t,s,a){for(var n=cljs.core.count(t),c=instaparse.repeat.parse_from_index(e,r,t,s,a),$=cljs.core.long$(a),l=instaparse.auto_flatten_seq.EMPTY,i=instaparse.repeat.select_parse(e,r,t,s,$,c),o=i,_=(cljs.core.nth.cljs$core$IFn$_invoke$arity$3(o,0,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(o,1,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(o,2,null),$),p=l,j=i;;){var u=_,k=p,v=j,y=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(v,0,null),f=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(v,1,null),g=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(v,2,null);if(null==v)return instaparse.repeat.failure_signal;if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(u,f))return instaparse.repeat.failure_signal;if(null==g)return instaparse.gll.safe_with_meta(instaparse.auto_flatten_seq.conj_flat(k,y),new cljs.core.PersistentArrayMap(null,3,[cljs.core.cst$kw$optimize,cljs.core.cst$kw$memory,cljs.core.cst$kw$instaparse$gll_SLASH_start_DASH_index,0,cljs.core.cst$kw$instaparse$gll_SLASH_end_DASH_index,n],null));var F=cljs.core.long$(f),I=instaparse.auto_flatten_seq.conj_flat(k,y),w=instaparse.repeat.select_parse(e,r,t,s,f,g);_=F,p=I,j=w}},instaparse.repeat.repeat_parse_no_tag.cljs$lang$maxFixedArity=5,instaparse.repeat.repeat_parse=function(e){for(var r=[],t=arguments.length,s=0;;){if(!(s<t))break;r.push(arguments[s]);s=s+1}switch(r.length){case 4:return instaparse.repeat.repeat_parse.cljs$core$IFn$_invoke$arity$4(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return instaparse.repeat.repeat_parse.cljs$core$IFn$_invoke$arity$5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw new Error([cljs.core.str("Invalid arity: "),cljs.core.str(r.length)].join(""))}},instaparse.repeat.repeat_parse.cljs$core$IFn$_invoke$arity$4=function(e,r,t,s){return instaparse.repeat.repeat_parse_no_tag.cljs$core$IFn$_invoke$arity$4(e,r,s,instaparse.gll.text__GT_segment(s))},instaparse.repeat.repeat_parse.cljs$core$IFn$_invoke$arity$5=function(e,r,t,s,a){if(!cljs.core.truth_(new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[cljs.core.cst$kw$hiccup,null,cljs.core.cst$kw$enlive,null],null),null).call(null,t)))throw new Error("Assert failed: (#{:hiccup :enlive} output-format)");return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(t,cljs.core.cst$kw$hiccup)?instaparse.repeat.repeat_parse_hiccup.cljs$core$IFn$_invoke$arity$5(e,r,s,a,instaparse.gll.text__GT_segment(a)):cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(t,cljs.core.cst$kw$enlive)?instaparse.repeat.repeat_parse_enlive.cljs$core$IFn$_invoke$arity$5(e,r,s,a,instaparse.gll.text__GT_segment(a)):null},instaparse.repeat.repeat_parse.cljs$lang$maxFixedArity=5,instaparse.repeat.repeat_parse_with_header=function(e,r,t,s,a,n){var c=instaparse.gll.text__GT_segment(n),$=cljs.core.count(n),l=instaparse.repeat.parse_from_index(e,r,n,c,0);if(cljs.core.truth_(function(){var e=cljs.core.empty_QMARK_(l);return e||cljs.core.cst$kw$hide.cljs$core$IFn$_invoke$arity$1(r)}()))return instaparse.repeat.failure_signal;var i=cljs.core.apply.cljs$core$IFn$_invoke$arity$3(cljs.core.max_key,instaparse.repeat.get_end,l),o=instaparse.repeat.get_end.cljs$core$IFn$_invoke$arity$1(i),_=instaparse.repeat.repeat_parse_no_tag.cljs$core$IFn$_invoke$arity$5(e,cljs.core.cst$kw$parser.cljs$core$IFn$_invoke$arity$1(t),n,c,o),p=new cljs.core.PersistentArrayMap(null,3,[cljs.core.cst$kw$optimize,cljs.core.cst$kw$memory,cljs.core.cst$kw$instaparse$gll_SLASH_start_DASH_index,0,cljs.core.cst$kw$instaparse$gll_SLASH_end_DASH_index,$],null);if(cljs.core.truth_(function(){var e=_ instanceof instaparse.gll.Failure;if(e)return e;var r=cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$tag.cljs$core$IFn$_invoke$arity$1(t),cljs.core.cst$kw$star);return r?instaparse.repeat.empty_result_QMARK_(_):r}()))return instaparse.repeat.failure_signal;switch(s instanceof cljs.core.Keyword?s.fqn:null){case"enlive":return instaparse.gll.safe_with_meta(new cljs.core.PersistentArrayMap(null,2,[cljs.core.cst$kw$tag,a,cljs.core.cst$kw$content,instaparse.auto_flatten_seq.conj_flat(instaparse.auto_flatten_seq.conj_flat(instaparse.auto_flatten_seq.EMPTY,i),_)],null),p);case"hiccup":return instaparse.gll.safe_with_meta(instaparse.auto_flatten_seq.convert_afs_to_vec(instaparse.auto_flatten_seq.conj_flat(instaparse.auto_flatten_seq.conj_flat(instaparse.auto_flatten_seq.auto_flatten_seq(new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[a],null)),i),_)),p);default:return instaparse.gll.safe_with_meta(instaparse.auto_flatten_seq.conj_flat(instaparse.auto_flatten_seq.conj_flat(instaparse.auto_flatten_seq.EMPTY,i),_),p)}},instaparse.repeat.try_repeating_parse_strategy_with_header=function(e,r,t,s,a){var n=cljs.core.cst$kw$parsers.cljs$core$IFn$_invoke$arity$1(s),c=cljs.core.last(n);if(cljs.core.not(function(){var e=cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$tag.cljs$core$IFn$_invoke$arity$1(s),cljs.core.cst$kw$cat);if(e){var r=new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,2,[cljs.core.cst$kw$star,null,cljs.core.cst$kw$plus,null],null),null).call(null,cljs.core.cst$kw$tag.cljs$core$IFn$_invoke$arity$1(c));return cljs.core.truth_(r)?cljs.core.not(cljs.core.cst$kw$hide.cljs$core$IFn$_invoke$arity$1(c))&&cljs.core.not(cljs.core.cst$kw$hide.cljs$core$IFn$_invoke$arity$1(cljs.core.cst$kw$parser.cljs$core$IFn$_invoke$arity$1(c))):r}return e}()))return instaparse.repeat.failure_signal;var $=cljs.core.apply.cljs$core$IFn$_invoke$arity$2(instaparse.combinators_source.cat,cljs.core.butlast(n));return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$red.cljs$core$IFn$_invoke$arity$1(s),instaparse.reduction.raw_non_terminal_reduction)?instaparse.repeat.repeat_parse_with_header(e,$,c,null,t,r):instaparse.repeat.repeat_parse_with_header(e,$,c,a,t,r)},instaparse.repeat.try_repeating_parse_strategy=function(e,r,t){var s=cljs.core.cst$kw$grammar.cljs$core$IFn$_invoke$arity$1(e),a=cljs.core.cst$kw$output_DASH_format.cljs$core$IFn$_invoke$arity$1(e),n=cljs.core.get.cljs$core$IFn$_invoke$arity$2(s,t);if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$hide.cljs$core$IFn$_invoke$arity$1(n),!0))return instaparse.repeat.failure_signal;if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$red.cljs$core$IFn$_invoke$arity$1(n),instaparse.reduction.raw_non_terminal_reduction)){if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$tag.cljs$core$IFn$_invoke$arity$1(n),cljs.core.cst$kw$star))return instaparse.repeat.repeat_parse.cljs$core$IFn$_invoke$arity$4(s,cljs.core.cst$kw$parser.cljs$core$IFn$_invoke$arity$1(n),a,r);if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$tag.cljs$core$IFn$_invoke$arity$1(n),cljs.core.cst$kw$plus)){var c=instaparse.repeat.repeat_parse.cljs$core$IFn$_invoke$arity$4(s,cljs.core.cst$kw$parser.cljs$core$IFn$_invoke$arity$1(n),a,r);return cljs.core.truth_(instaparse.repeat.empty_result_QMARK_(c))?instaparse.repeat.failure_signal:c}return instaparse.repeat.try_repeating_parse_strategy_with_header(s,r,t,n,a)}if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$tag.cljs$core$IFn$_invoke$arity$1(n),cljs.core.cst$kw$star))return instaparse.repeat.repeat_parse.cljs$core$IFn$_invoke$arity$5(s,cljs.core.cst$kw$parser.cljs$core$IFn$_invoke$arity$1(n),a,t,r);if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$tag.cljs$core$IFn$_invoke$arity$1(n),cljs.core.cst$kw$plus)){var c=instaparse.repeat.repeat_parse.cljs$core$IFn$_invoke$arity$5(s,cljs.core.cst$kw$parser.cljs$core$IFn$_invoke$arity$1(n),a,t,r);return cljs.core.truth_(instaparse.repeat.empty_result_QMARK_(c))?instaparse.repeat.failure_signal:c}return instaparse.repeat.try_repeating_parse_strategy_with_header(s,r,t,n,a)},instaparse.repeat.used_memory_optimization_QMARK_=function(e){return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(cljs.core.cst$kw$memory,cljs.core.cst$kw$optimize.cljs$core$IFn$_invoke$arity$1(cljs.core.meta(e)))};