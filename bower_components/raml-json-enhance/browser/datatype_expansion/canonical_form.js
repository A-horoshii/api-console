goog.provide("datatype_expansion.canonical_form"),goog.require("cljs.core"),goog.require("clojure.string"),goog.require("clojure.set"),goog.require("datatype_expansion.utils"),datatype_expansion.canonical_form.atomic_types=new cljs.core.PersistentHashSet(null,new cljs.core.PersistentArrayMap(null,13,["json",null,"boolean",null,"string",null,"xml",null,"time-only",null,"any",null,"number",null,"datetime",null,"date-only",null,"integer",null,"datetime-only",null,"file",null,"nil",null],null),null),datatype_expansion.canonical_form.union_QMARK_=function(c){return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2("union",cljs.core.get.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$type))},datatype_expansion.canonical_form.any_QMARK_=function(c){return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2("any",cljs.core.get.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$type))},datatype_expansion.canonical_form.number_type_QMARK_=function(c){return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2("number",cljs.core.get.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$type))},datatype_expansion.canonical_form.integer_type_QMARK_=function(c){return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2("integer",cljs.core.get.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$type))},"undefined"!=typeof datatype_expansion.canonical_form.lt_restriction||(datatype_expansion.canonical_form.lt_restriction=function(){var c=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),e=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),r=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),n=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),o=cljs.core.get.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentArrayMap.EMPTY,cljs.core.cst$kw$hierarchy,cljs.core.get_global_hierarchy());return new cljs.core.MultiFn(cljs.core.symbol.cljs$core$IFn$_invoke$arity$2("datatype-expansion.canonical-form","lt-restriction"),function(c,e,r,n,o){return function(c,e,r){return c}}(c,e,r,n,o),cljs.core.cst$kw$default,o,c,e,r,n)}()),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$minProperties,function(c,e,r){if(r>=e){var n=e,o=r;return n>o?n:o}return datatype_expansion.utils.error("sub type has a weaker constraint for min-properties than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$maxProperties,function(c,e,r){if(r<=e){var n=e,o=r;return n<o?n:o}return datatype_expansion.utils.error("sub type has a weaker constraint for max-properties than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$required,function(c,e,r){if(e===!0)return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r)?cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r):datatype_expansion.utils.error("Error in required property, making optional base class required property");var n=e;return cljs.core.truth_(n)?n:r}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$discriminator,function(c,e,r){var n=cljs.core.filter.cljs$core$IFn$_invoke$arity$2(cljs.core.some_QMARK_,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,r],null)),o=cljs.core.count(n),t=cljs.core._EQ_;if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(0,t):o.call(null,0,t)))return null;if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(1,t):o.call(null,1,t)))return cljs.core.first(n);if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(2,t):o.call(null,2,t)))return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r)?e:datatype_expansion.utils.error([cljs.core.str("Different values for discriminator constraint"),cljs.core.str(new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,r],null))].join(""));throw new Error([cljs.core.str("No matching clause: "),cljs.core.str(t)].join(""))}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$discriminatorValue,function(c,e,r){var n=cljs.core.filter.cljs$core$IFn$_invoke$arity$2(cljs.core.some_QMARK_,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,r],null)),o=cljs.core.count(n),t=cljs.core._EQ_;if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(0,t):o.call(null,0,t)))return null;if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(1,t):o.call(null,1,t)))return cljs.core.first(n);if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(2,t):o.call(null,2,t)))return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r)?e:datatype_expansion.utils.error([cljs.core.str("Different values for discriminator-value constraint"),cljs.core.str(new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,r],null))].join(""));throw new Error([cljs.core.str("No matching clause: "),cljs.core.str(t)].join(""))}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$minLength,function(c,e,r){if(r>=e){var n=e,o=r;return n>o?n:o}return datatype_expansion.utils.error("sub type has a weaker constraint for min-length than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$maxLength,function(c,e,r){if(r<=e){var n=e,o=r;return n<o?n:o}return datatype_expansion.utils.error("sub type has a weaker constraint for max-length than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$minimum,function(c,e,r){if(r>=e){var n=e,o=r;return n>o?n:o}return datatype_expansion.utils.error("sub type has a weaker constraint for minimum than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$maximum,function(c,e,r){if(r<=e){var n=e,o=r;return n<o?n:o}return datatype_expansion.utils.error("sub type has a weaker constraint for maximum than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$format,function(c,e,r){var n=cljs.core.filter.cljs$core$IFn$_invoke$arity$2(cljs.core.some_QMARK_,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,r],null)),o=cljs.core.count(n),t=cljs.core._EQ_;if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(0,t):o.call(null,0,t)))return null;if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(1,t):o.call(null,1,t)))return cljs.core.first(n);if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(2,t):o.call(null,2,t)))return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r)?e:datatype_expansion.utils.error([cljs.core.str("Different values for format constraint"),cljs.core.str(new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,r],null))].join(""));throw new Error([cljs.core.str("No matching clause: "),cljs.core.str(t)].join(""))}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$pattern,function(c,e,r){var n=cljs.core.filter.cljs$core$IFn$_invoke$arity$2(cljs.core.some_QMARK_,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,r],null)),o=cljs.core.count(n),t=cljs.core._EQ_;if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(0,t):o.call(null,0,t)))return null;if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(1,t):o.call(null,1,t)))return cljs.core.first(n);if(cljs.core.truth_(o.cljs$core$IFn$_invoke$arity$2?o.cljs$core$IFn$_invoke$arity$2(2,t):o.call(null,2,t)))return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r)?e:datatype_expansion.utils.error([cljs.core.str("Different values for pattern constraint"),cljs.core.str(new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,r],null))].join(""));throw new Error([cljs.core.str("No matching clause: "),cljs.core.str(t)].join(""))}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$uniqueItems,function(c,e,r){if(e===!1||cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r)){var n=e;return cljs.core.truth_(n)?r:n}return datatype_expansion.utils.error("sub type has a weaker constraint for unique-items than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$minItems,function(c,e,r){if(r>=e){var n=e,o=r;return n>o?n:o}return datatype_expansion.utils.error("sub type has a weaker constraint for min-items than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$maxItems,function(c,e,r){if(r<=e){var n=e,o=r;return n<o?n:o}return datatype_expansion.utils.error("sub type has a weaker constraint for max-items than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$enum,function(c,e,r){return cljs.core.truth_(clojure.set.subset_QMARK_(cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,r),cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,e)))?clojure.set.intersection.cljs$core$IFn$_invoke$arity$2(cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,e),cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,r)):datatype_expansion.utils.error("sub type has a weaker constraint for enum-values than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$additionalProperties,function(c,e,r){if(e===!0||cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r)){var n=e;return cljs.core.truth_(n)?r:n}return datatype_expansion.utils.error("sub type has a weaker constraint for additional-properties than base type")}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$type,function(c,e,r){return cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,"union")||cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(r,"union")?"union":cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(e,r)?e:datatype_expansion.utils.error([cljs.core.str("Cannot compute min value of different sub types")].join(""))}),datatype_expansion.canonical_form.lt_restriction.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$default,function(c,e,r){var n=r;return cljs.core.truth_(n)?n:e}),datatype_expansion.canonical_form.lt_restrictions=function(c,e){for(var r=cljs.core.PersistentArrayMap.EMPTY,n=cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,cljs.core.concat.cljs$core$IFn$_invoke$arity$2(cljs.core.keys(c),cljs.core.keys(e)));;){if(cljs.core.empty_QMARK_(n))return r;var o=cljs.core.first(n),t=cljs.core.get.cljs$core$IFn$_invoke$arity$2(c,o),s=cljs.core.get.cljs$core$IFn$_invoke$arity$2(e,o);if(null!=t&&null!=s){var l=cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(r,o,datatype_expansion.canonical_form.lt_restriction.cljs$core$IFn$_invoke$arity$3?datatype_expansion.canonical_form.lt_restriction.cljs$core$IFn$_invoke$arity$3(o,t,s):datatype_expansion.canonical_form.lt_restriction.call(null,o,t,s)),$=cljs.core.rest(n);r=l,n=$}else{var a=cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(r,o,function(){var c=t;return cljs.core.truth_(c)?c:s}()),i=cljs.core.rest(n);r=a,n=i}}},datatype_expansion.canonical_form.consistency_checks=new cljs.core.PersistentArrayMap(null,4,[cljs.core.cst$kw$numProperties,function(c){var e=c,r=null==e||!(64&e.cljs$lang$protocol_mask$partition0$||e.cljs$core$ISeq$)?e:cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,e),n=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$minProperties),o=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$maxProperties);if(cljs.core.some_QMARK_(n)&&cljs.core.some_QMARK_(o)){if(n<=o)return!0;throw new Error([cljs.core.str("Consistency check failure for property "),cljs.core.str(cljs.core.cst$kw$numProperties),cljs.core.str(" and values ["),cljs.core.str(n),cljs.core.str(" "),cljs.core.str(o),cljs.core.str("]")].join(""))}return!0},cljs.core.cst$kw$length,function(c){var e=c,r=null==e||!(64&e.cljs$lang$protocol_mask$partition0$||e.cljs$core$ISeq$)?e:cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,e),n=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$minLength),o=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$maxLength);if(cljs.core.some_QMARK_(n)&&cljs.core.some_QMARK_(o)){if(n<=o)return!0;throw new Error([cljs.core.str("Consistency check failure for property "),cljs.core.str(cljs.core.cst$kw$length),cljs.core.str(" and values ["),cljs.core.str(n),cljs.core.str(" "),cljs.core.str(o),cljs.core.str("]")].join(""))}return!0},cljs.core.cst$kw$size,function(c){var e=c,r=null==e||!(64&e.cljs$lang$protocol_mask$partition0$||e.cljs$core$ISeq$)?e:cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,e),n=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$minimum),o=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$maximum);if(cljs.core.some_QMARK_(n)&&cljs.core.some_QMARK_(o)){if(n<=o)return!0;throw new Error([cljs.core.str("Consistency check failure for property "),cljs.core.str(cljs.core.cst$kw$size),cljs.core.str(" and values ["),cljs.core.str(n),cljs.core.str(" "),cljs.core.str(o),cljs.core.str("]")].join(""))}return!0},cljs.core.cst$kw$numItems,function(c){var e=c,r=null==e||!(64&e.cljs$lang$protocol_mask$partition0$||e.cljs$core$ISeq$)?e:cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,e),n=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$minItems),o=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$maxItems);if(cljs.core.some_QMARK_(n)&&cljs.core.some_QMARK_(o)){if(n<=o)return!0;throw new Error([cljs.core.str("Consistency check failure for property "),cljs.core.str(cljs.core.cst$kw$numItems),cljs.core.str(" and values ["),cljs.core.str(n),cljs.core.str(" "),cljs.core.str(o),cljs.core.str("]")].join(""))}return!0}],null),datatype_expansion.canonical_form.consistency_check=function(c){for(var e=cljs.core.seq(datatype_expansion.canonical_form.consistency_checks),r=null,n=0,o=0;;)if(o<n){var t=r.cljs$core$IIndexed$_nth$arity$2(null,o),s=(cljs.core.nth.cljs$core$IFn$_invoke$arity$3(t,0,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(t,1,null));s.cljs$core$IFn$_invoke$arity$1?s.cljs$core$IFn$_invoke$arity$1(c):s.call(null,c);var l=e,$=r,a=n,i=o+1;e=l,r=$,n=a,o=i}else{var _=cljs.core.seq(e);if(!_)break;var j=_;if(cljs.core.chunked_seq_QMARK_(j)){var u=cljs.core.chunk_first(j),y=cljs.core.chunk_rest(j),p=u,f=cljs.core.count(u),k=0;e=y,r=p,n=f,o=k;continue}var m=cljs.core.first(j),d=(cljs.core.nth.cljs$core$IFn$_invoke$arity$3(m,0,null),cljs.core.nth.cljs$core$IFn$_invoke$arity$3(m,1,null));d.cljs$core$IFn$_invoke$arity$1?d.cljs$core$IFn$_invoke$arity$1(c):d.call(null,c);var v=cljs.core.next(j),I=null,F=0,w=0;e=v,r=I,n=F,o=w}return c},datatype_expansion.canonical_form.lt_dispatch_fn=function(c,e){return cljs.core.truth_(function(){var r=datatype_expansion.canonical_form.any_QMARK_(c);return cljs.core.truth_(r)?cljs.core.not(datatype_expansion.canonical_form.any_QMARK_(e)):r}())?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["any",cljs.core.cst$kw$other],null):cljs.core.truth_(function(){var r=cljs.core.not(datatype_expansion.canonical_form.any_QMARK_(c));return r?datatype_expansion.canonical_form.any_QMARK_(e):r}())?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.cst$kw$other,"any"],null):cljs.core.truth_(function(){var r=datatype_expansion.canonical_form.union_QMARK_(c);return cljs.core.truth_(r)?cljs.core.not(datatype_expansion.canonical_form.union_QMARK_(e)):r}())?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["union",cljs.core.cst$kw$other],null):cljs.core.truth_(function(){var r=cljs.core.not(datatype_expansion.canonical_form.union_QMARK_(c));return r?datatype_expansion.canonical_form.union_QMARK_(e):r}())?new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.cst$kw$other,"union"],null):new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(c),cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(e)],null)},"undefined"!=typeof datatype_expansion.canonical_form.lt||(datatype_expansion.canonical_form.lt=function(){var c=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),e=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),r=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),n=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),o=cljs.core.get.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentArrayMap.EMPTY,cljs.core.cst$kw$hierarchy,cljs.core.get_global_hierarchy());return new cljs.core.MultiFn(cljs.core.symbol.cljs$core$IFn$_invoke$arity$2("datatype-expansion.canonical-form","lt"),function(c,e,r,n,o){return function(c,e){return datatype_expansion.canonical_form.lt_dispatch_fn(c,e)}}(c,e,r,n,o),cljs.core.cst$kw$default,o,c,e,r,n)}()),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["any","any"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["any",cljs.core.cst$kw$other],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$type,cljs.core.get.cljs$core$IFn$_invoke$arity$2(e,cljs.core.cst$kw$type)),e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.cst$kw$other,"any"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(e,cljs.core.cst$kw$type,cljs.core.get.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$type))))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["boolean","boolean"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["datetime","datetime"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["datetime-only","datetime-only"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["date-only","date-only"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["number","number"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["integer","integer"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["number","integer"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$type,"integer"),cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(e,cljs.core.cst$kw$type,"integer")))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["string","string"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["nil","nil"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["file","file"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["json","json"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["xml","xml"],null),function(c,e){return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt_restrictions(c,e))}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["array","array"],null),function(c,e){var r=function(){var r=cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(cljs.core.cst$kw$items.cljs$core$IFn$_invoke$arity$1(e),cljs.core.cst$kw$type,cljs.core.cst$kw$items.cljs$core$IFn$_invoke$arity$1(c));return datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1?datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1(r):datatype_expansion.canonical_form.canonical_form.call(null,r)}(),n=datatype_expansion.canonical_form.lt_restrictions(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$items),cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(e,cljs.core.cst$kw$items)),o=datatype_expansion.canonical_form.consistency_check(n);return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(o,cljs.core.cst$kw$items,r)}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["object","object"],null),function(c,e){var r=cljs.core.cst$kw$properties.cljs$core$IFn$_invoke$arity$1(c),n=cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,cljs.core.keys(r)),o=cljs.core.cst$kw$properties.cljs$core$IFn$_invoke$arity$1(e),t=cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentHashSet.EMPTY,cljs.core.keys(o)),s=clojure.set.intersection.cljs$core$IFn$_invoke$arity$2(n,t),l=datatype_expansion.canonical_form.lt_restrictions(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$properties),cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(e,cljs.core.cst$kw$properties)),$=datatype_expansion.canonical_form.consistency_check(l),a=cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentArrayMap.EMPTY,cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(function(c,e,r,n,o,t,s){return function(e){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,function(){var n=cljs.core.get.cljs$core$IFn$_invoke$arity$2(c,e),o=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,e);return datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2?datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2(n,o):datatype_expansion.canonical_form.lt.call(null,n,o)}()],null)}}(r,n,o,t,s,l,$),s)),i=cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentArrayMap.EMPTY,cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(function(c,e,r,n,o,t,s,l){return function(e){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[e,cljs.core.get.cljs$core$IFn$_invoke$arity$2(c,e)],null)}}(r,n,o,t,s,l,$,a),clojure.set.difference.cljs$core$IFn$_invoke$arity$2(n,s))),_=cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentArrayMap.EMPTY,cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(function(c,e,r,n,o,t,s,l,$){return function(c){return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[c,cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,c)],null)}}(r,n,o,t,s,l,$,a,i),clojure.set.difference.cljs$core$IFn$_invoke$arity$2(t,s))),j=cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([i,a,_],0));return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3($,cljs.core.cst$kw$properties,j)}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["union","union"],null),function(c,e){var r=cljs.core.cst$kw$anyOf.cljs$core$IFn$_invoke$arity$1(c),n=cljs.core.cst$kw$anyOf.cljs$core$IFn$_invoke$arity$1(e),o=cljs.core.empty_QMARK_(n)?r:cljs.core.empty_QMARK_(r)?n:cljs.core.flatten(cljs.core.map.cljs$core$IFn$_invoke$arity$2(function(c,e){return function(r){return cljs.core.map.cljs$core$IFn$_invoke$arity$2(function(c,e){return function(c){return datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2?datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2(c,r):datatype_expansion.canonical_form.lt.call(null,c,r)}}(c,e),c)}}(r,n),n)),t=datatype_expansion.canonical_form.lt_restrictions(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$anyOf),cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(e,cljs.core.cst$kw$anyOf));return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(t,cljs.core.cst$kw$anyOf,o)}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,["union",cljs.core.cst$kw$other],null),function(c,e){var r=cljs.core.cst$kw$anyOf.cljs$core$IFn$_invoke$arity$1(c),n=cljs.core.map.cljs$core$IFn$_invoke$arity$2(function(c){return function(c){return datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2?datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2(c,e):datatype_expansion.canonical_form.lt.call(null,c,e)}}(r),r),o=datatype_expansion.canonical_form.lt_restrictions(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$anyOf),cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(e,cljs.core.cst$kw$items),cljs.core.cst$kw$properties));return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(o,cljs.core.cst$kw$anyOf,n)}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.cst$kw$other,"union"],null),function(c,e){var r=cljs.core.cst$kw$anyOf.cljs$core$IFn$_invoke$arity$1(e),n=cljs.core.map.cljs$core$IFn$_invoke$arity$2(function(e){return function(e){return datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2?datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2(e,c):datatype_expansion.canonical_form.lt.call(null,e,c)}}(r),r),o=datatype_expansion.canonical_form.lt_restrictions(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(c,cljs.core.cst$kw$items),cljs.core.cst$kw$properties),cljs.core.cst$kw$anyOf),cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(e,cljs.core.cst$kw$items),cljs.core.cst$kw$properties),cljs.core.cst$kw$anyOf));return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(o,cljs.core.cst$kw$anyOf,n)}),datatype_expansion.canonical_form.lt.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$default,function(c,e){throw new datatype_expansion.canonical_form.Exception([cljs.core.str("Invalid inheriance "),cljs.core.str(cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(c)),cljs.core.str(" -> "),cljs.core.str(cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(e))].join(""))}),datatype_expansion.canonical_form.dispatch_node=function(c){var e=c,r=null==e||!(64&e.cljs$lang$protocol_mask$partition0$||e.cljs$core$ISeq$)?e:cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,e),n=cljs.core.get.cljs$core$IFn$_invoke$arity$2(r,cljs.core.cst$kw$type);return cljs.core.map_QMARK_(n)?cljs.core.cst$kw$inheritance:cljs.core.coll_QMARK_(n)?cljs.core.cst$kw$multiple_DASH_inheritance:cljs.core.truth_(cljs.core.get.cljs$core$IFn$_invoke$arity$2(datatype_expansion.canonical_form.atomic_types,n))?cljs.core.cst$kw$atomic:n},"undefined"!=typeof datatype_expansion.canonical_form.canonical_form||(datatype_expansion.canonical_form.canonical_form=function(){var c=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),e=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),r=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c)}(),n=function(){var c=cljs.core.PersistentArrayMap.EMPTY;return cljs.core.atom.cljs$core$IFn$_invoke$arity$1?cljs.core.atom.cljs$core$IFn$_invoke$arity$1(c):cljs.core.atom.call(null,c);
}(),o=cljs.core.get.cljs$core$IFn$_invoke$arity$3(cljs.core.PersistentArrayMap.EMPTY,cljs.core.cst$kw$hierarchy,cljs.core.get_global_hierarchy());return new cljs.core.MultiFn(cljs.core.symbol.cljs$core$IFn$_invoke$arity$2("datatype-expansion.canonical-form","canonical-form"),function(c,e,r,n,o){return function(c){return datatype_expansion.canonical_form.dispatch_node(c)}}(c,e,r,n,o),cljs.core.cst$kw$default,o,c,e,r,n)}()),datatype_expansion.canonical_form.canonical_form.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$atomic,function(c){return datatype_expansion.canonical_form.consistency_check(c)}),datatype_expansion.canonical_form.canonical_form.cljs$core$IMultiFn$_add_method$arity$3(null,"array",function(c){var e=function(){var e=cljs.core.cst$kw$items.cljs$core$IFn$_invoke$arity$1(c);return datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1?datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1(e):datatype_expansion.canonical_form.canonical_form.call(null,e)}(),r=datatype_expansion.canonical_form.consistency_check(c);if(cljs.core.truth_(datatype_expansion.canonical_form.union_QMARK_(e))){var n=cljs.core.map.cljs$core$IFn$_invoke$arity$2(function(c,e){return function(c){return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(e,cljs.core.cst$kw$items,c)}}(e,r),cljs.core.cst$kw$anyOf.cljs$core$IFn$_invoke$arity$1(e));return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(e,cljs.core.cst$kw$anyOf,n)}return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(r,cljs.core.cst$kw$items,e)}),datatype_expansion.canonical_form.append_property=function(c,e,r){return cljs.core.map.cljs$core$IFn$_invoke$arity$2(function(c){var n=cljs.core.cst$kw$properties.cljs$core$IFn$_invoke$arity$1(c),o=cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(n,e,r);return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$properties,o)},c)},datatype_expansion.canonical_form.expand_property=function(c,e,r){return cljs.core.flatten(cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(function(c){var n=cljs.core.cst$kw$properties.cljs$core$IFn$_invoke$arity$1(c),o=cljs.core.cst$kw$required.cljs$core$IFn$_invoke$arity$1(r),t=cljs.core.cst$kw$anyOf.cljs$core$IFn$_invoke$arity$1(r);return cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(function(e,r,n){return function(e){return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$properties,e)}}(n,o,t),cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(function(c,r,n){return function(r){return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,e,r)}}(n,o,t),cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(function(c,e,r){return function(c){return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$required,e)}}(n,o,t),t)))},c))},datatype_expansion.canonical_form.make_union_from_object_expansion=function(c,e){return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(e,cljs.core.cst$kw$properties),cljs.core.cst$kw$type,"union"),cljs.core.cst$kw$anyOf,c)},datatype_expansion.canonical_form.canonical_form.cljs$core$IMultiFn$_add_method$arity$3(null,"object",function(c){for(var e=cljs.core.cst$kw$properties.cljs$core$IFn$_invoke$arity$1(c),r=cljs.core.into.cljs$core$IFn$_invoke$arity$2(cljs.core.PersistentArrayMap.EMPTY,cljs.core.mapv.cljs$core$IFn$_invoke$arity$2(function(c){return function(c){var e=c,r=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(e,0,null),n=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(e,1,null);if(clojure.string.ends_with_QMARK_(r,"?")&&null==cljs.core.cst$kw$required.cljs$core$IFn$_invoke$arity$1(n)){var o=clojure.string.replace(r,"?",""),t=cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(n,cljs.core.cst$kw$required,!1);return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[o,t],null)}return new cljs.core.PersistentVector(null,2,5,cljs.core.PersistentVector.EMPTY_NODE,[r,n],null)}}(e),e)),n=new cljs.core.PersistentVector(null,1,5,cljs.core.PersistentVector.EMPTY_NODE,[cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$properties,cljs.core.PersistentArrayMap.EMPTY)],null),o=r,t=n;;){if(cljs.core.empty_QMARK_(o))return datatype_expansion.canonical_form.consistency_check(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(1,cljs.core.count(t))?cljs.core.first(t):datatype_expansion.canonical_form.make_union_from_object_expansion(t,c));var s=cljs.core.first(o),l=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(s,0,null),$=cljs.core.nth.cljs$core$IFn$_invoke$arity$3(s,1,null),a=datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1?datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1($):datatype_expansion.canonical_form.canonical_form.call(null,$);if(cljs.core.truth_(datatype_expansion.canonical_form.union_QMARK_(a))){var i=cljs.core.rest(o),_=datatype_expansion.canonical_form.expand_property(t,l,a);o=i,t=_}else{var j=cljs.core.rest(o),u=datatype_expansion.canonical_form.append_property(t,l,a);o=j,t=u}}}),datatype_expansion.canonical_form.find_class=function c(e){if(cljs.core.some_QMARK_(cljs.core.cst$kw$properties.cljs$core$IFn$_invoke$arity$1(e)))return"object";if(cljs.core.some_QMARK_(cljs.core.cst$kw$items.cljs$core$IFn$_invoke$arity$1(e)))return"array";if("string"==typeof cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(e))return cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(e);if(cljs.core.map_QMARK_(cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(e)))return c(cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(e));if(cljs.core.coll_QMARK_(cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(e))){var r=cljs.core.first(cljs.core.filter.cljs$core$IFn$_invoke$arity$2(cljs.core.some_QMARK_,cljs.core.map.cljs$core$IFn$_invoke$arity$2(function(e){try{return c(e)}catch(c){if(c instanceof Error){return null}throw c}},cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(e))));return null==r?datatype_expansion.utils.error("Cannot find top level class for node, not in expanded form"):r}return datatype_expansion.utils.error("Cannot find top level class for node, not in expanded form")},datatype_expansion.canonical_form.canonical_form.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$inheritance,function(c){var e=datatype_expansion.canonical_form.find_class(c),r=function(){var e=cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(c);return datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1?datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1(e):datatype_expansion.canonical_form.canonical_form.call(null,e)}(),n=cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$type,e),o=function(){var c=cljs.core._EQ_,r=e;return cljs.core.truth_(c.cljs$core$IFn$_invoke$arity$2?c.cljs$core$IFn$_invoke$arity$2("array",r):c.call(null,"array",r))?cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(n,cljs.core.cst$kw$items,cljs.core.get.cljs$core$IFn$_invoke$arity$3(n,cljs.core.cst$kw$items,new cljs.core.PersistentArrayMap(null,1,[cljs.core.cst$kw$type,"any"],null))):cljs.core.truth_(c.cljs$core$IFn$_invoke$arity$2?c.cljs$core$IFn$_invoke$arity$2("object",r):c.call(null,"object",r))?cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(n,cljs.core.cst$kw$properties,cljs.core.get.cljs$core$IFn$_invoke$arity$3(n,cljs.core.cst$kw$properties,cljs.core.PersistentArrayMap.EMPTY)):cljs.core.truth_(c.cljs$core$IFn$_invoke$arity$2?c.cljs$core$IFn$_invoke$arity$2("union",r):c.call(null,"union",r))?cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(n,cljs.core.cst$kw$anyOf,cljs.core.get.cljs$core$IFn$_invoke$arity$3(n,cljs.core.cst$kw$anyOf,cljs.core.PersistentVector.EMPTY)):n}(),t=datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1?datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1(o):datatype_expansion.canonical_form.canonical_form.call(null,o);return datatype_expansion.canonical_form.consistency_check(datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2?datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2(r,t):datatype_expansion.canonical_form.lt.call(null,r,t))}),datatype_expansion.canonical_form.canonical_form.cljs$core$IMultiFn$_add_method$arity$3(null,cljs.core.cst$kw$multiple_DASH_inheritance,function(c){var e=datatype_expansion.canonical_form.find_class(c),r=cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$type,e),n=function(){var c=cljs.core._EQ_,n=e;return cljs.core.truth_(c.cljs$core$IFn$_invoke$arity$2?c.cljs$core$IFn$_invoke$arity$2("array",n):c.call(null,"array",n))?cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(r,cljs.core.cst$kw$items,cljs.core.get.cljs$core$IFn$_invoke$arity$3(r,cljs.core.cst$kw$items,new cljs.core.PersistentArrayMap(null,1,[cljs.core.cst$kw$type,"any"],null))):cljs.core.truth_(c.cljs$core$IFn$_invoke$arity$2?c.cljs$core$IFn$_invoke$arity$2("object",n):c.call(null,"object",n))?cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(r,cljs.core.cst$kw$properties,cljs.core.get.cljs$core$IFn$_invoke$arity$3(r,cljs.core.cst$kw$properties,cljs.core.PersistentVector.EMPTY)):cljs.core.truth_(c.cljs$core$IFn$_invoke$arity$2?c.cljs$core$IFn$_invoke$arity$2("union",n):c.call(null,"union",n))?cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(r,cljs.core.cst$kw$anyOf,cljs.core.get.cljs$core$IFn$_invoke$arity$3(r,cljs.core.cst$kw$anyOf,cljs.core.PersistentVector.EMPTY)):r}(),o=function(){var o=datatype_expansion.canonical_form.consistency_check(cljs.core.reduce.cljs$core$IFn$_invoke$arity$3(function(c,e,r){return function(c,e){var r=function(){var r=datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1?datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1(e):datatype_expansion.canonical_form.canonical_form.call(null,e),n=c;return datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2?datatype_expansion.canonical_form.lt.cljs$core$IFn$_invoke$arity$2(r,n):datatype_expansion.canonical_form.lt.call(null,r,n)}();return r}}(e,r,n),n,cljs.core.cst$kw$type.cljs$core$IFn$_invoke$arity$1(c)));return datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1?datatype_expansion.canonical_form.canonical_form.cljs$core$IFn$_invoke$arity$1(o):datatype_expansion.canonical_form.canonical_form.call(null,o)}();return o}),datatype_expansion.canonical_form.canonical_form.cljs$core$IMultiFn$_add_method$arity$3(null,"union",function(c){return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(c,cljs.core.cst$kw$anyOf,cljs.core.flatten(cljs.core.distinct.cljs$core$IFn$_invoke$arity$1(cljs.core.map.cljs$core$IFn$_invoke$arity$2(function(c){return cljs.core.truth_(datatype_expansion.canonical_form.union_QMARK_(c))?cljs.core.cst$kw$anyOf.cljs$core$IFn$_invoke$arity$1(c):c},cljs.core.flatten(cljs.core.map.cljs$core$IFn$_invoke$arity$2(datatype_expansion.canonical_form.canonical_form,cljs.core.cst$kw$anyOf.cljs$core$IFn$_invoke$arity$1(c)))))))});