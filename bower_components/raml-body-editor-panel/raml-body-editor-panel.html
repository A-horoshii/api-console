<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-tabs/paper-tab.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../arc-icons/arc-icons.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">

<link rel="import" href="../code-mirror/code-mirror.html">
<link rel="import" href="../body-json-editor/body-json-editor.html">
<link rel="import" href="../body-form-editor/body-form-editor.html">
<link rel="import" href="cm-arc-styles.html">

</head><body><dom-module id="raml-body-editor-panel">
  <template>
    <style>
     :host {
      display: block;

      @apply(--raml-body-editor-panel);

      --paper-tabs-content: {
        overflow: auto;
      }
    }

    .content-actions {
      @apply(--layout-horizontal);
      @apply(--layout-center);
    }

    .actions-divider {
      @apply(--layout-flex);
    }

    paper-icon-button[active] {
      background-color: var(raml-body-editor-panel-button-active, #BDBDBD);
    }
    </style>
    <div class="content-actions">
      <paper-icon-button icon="arc:content-copy" id="copyButton"></paper-icon-button>
      <paper-icon-button icon="arc:list" id="formButton" toggles="" active="{{formView}}"></paper-icon-button>
      <paper-tooltip for="copyButton">Copy current editor value to clipboard</paper-tooltip>
      <paper-tooltip for="formButton">Toggle form / source editor view</paper-tooltip>

      <template is="dom-if" if="[[_computeHasMany(mimeTypes)]]">
        <paper-dropdown-menu label="Select content type" no-label-float="">
          <paper-listbox class="dropdown-content" attr-for-selected="data-mime" selected="{{contentType}}">
            <template is="dom-repeat" items="[[mimeTypes]]">
              <paper-item data-mime$="[[item]]">[[item]]</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
      </template>

      <span class="actions-divider"></span>

      <paper-menu-button horizontal-align="right">
        <paper-icon-button icon="arc:more-vert" class="dropdown-trigger"></paper-icon-button>
        <paper-menu class="dropdown-content">
          <paper-item on-tap="clearForm">Clear form</paper-item>
          
        </paper-menu>
      </paper-menu-button>
    </div>
    <iron-pages selected="{{selected}}" attr-for-selected="data-editor" selected-attribute="opened">
      <div class="cm-tab-editor" data-editor="code-mirror">
        <code-mirror opened="" mode="[[cmMode]]" value="{{_valueCodeMirror}}" theme="cm-arc"></code-mirror>
      </div>
      <body-json-editor data-editor="json" narrow="[[narrow]]" value="{{_valueJson}}" type="[[selectedType]]"></body-json-editor>
      <body-form-editor data-editor="form" value="{{_valueForm}}" type="[[selectedType]]"></body-form-editor>
      
    </iron-pages>
  </template>
  <script>Polymer({is:"raml-body-editor-panel",properties:{selected:{type:String,value:"code-mirror",observer:"_selectedChanged"},value:{type:String,value:"",notify:!0},cmMode:{type:String,value:"application/json",computed:"_computeCmMode(contentType)"},contentType:{type:String,notify:!0},body:{type:Array,observer:"_bodyChanged"},mimeTypes:{type:Array,readOnly:!0,observer:"_mimeTypesChanged"},selectedType:{type:Object,computed:"_computeSelectedType(contentType, body)"},_valueCodeMirror:String,_valueJson:String,_valueForm:String,_valueXml:String,narrow:{type:Boolean,value:!1},formView:{type:Boolean,observer:"_formViewChanged"}},observers:["_valueChanged(value)","_editorCodeMirrorChanged(selected, _valueCodeMirror)","_editorJsonChanged(selected, _valueJson)","_editorFormChanged(selected, _valueForm)","_editorXmlChanged(selected, _valueXml)"],attached:function(){this.listen(window,"content-type-changed","_ctHandler")},detached:function(){this.unlisten(window,"content-type-changed","_ctHandler")},ready:function(){this._isReady=!0},_selectedChanged:function(e,t){if(void 0!==t)if("code-mirror"===e)switch(t){case"json":this.set("_valueCodeMirror",this._valueJson);break;case"xml":this.set("_valueCodeMirror",this._valueXml);break;case"form":this.set("_valueCodeMirror",this._valueForm)}else switch(e){case"json":this.set("_valueJson",this._valueCodeMirror);break;case"xml":this.set("_valueXml",this._valueCodeMirror);break;case"form":this.set("_valueForm",this._valueCodeMirror)}},_editorCodeMirrorChanged:function(e,t){"code-mirror"===e&&this.set("value",t)},_editorJsonChanged:function(e,t){"json"===e&&this.set("value",t)},_editorFormChanged:function(e,t){"form"===e&&this.set("value",t)},_editorXmlChanged:function(e,t){"xml"===e&&this.set("value",t)},_ctHandler:function(e){this.set("contentType",e.detail.value)},_computeCmMode:function(e){return e},_valueChanged:function(e){this.fire("body-value-changed",{value:e})},_cleanBodySettings:function(){this._setMimeTypes(void 0)},_bodyChanged:function(e){if(this._cleanBodySettings(),e&&e instanceof Array){var t=e.map(function(e){return e.key});this._setMimeTypes(t),t&&t.length&&this.set("contentType",t[0])}},_mimeTypesChanged:function(e){e&&e[0]!==this.contentType&&this.fire("content-type-changed",{value:e[0]})},_computeHasMany:function(e){return!!(e&&e instanceof Array)&&e.length>1},_computeSelectedType:function(e,t){if(e&&t&&t.length)return this._getBodyForMime(e,t)},_getBodyForMime:function(e,t){if(t=t||this.body,e&&t&&t.length)for(var o=0,n=t.length;o<n;o++)if(t[o].key===e)return t[o]},_formViewChanged:function(e,t){if(void 0!==t)if(e){var o,n=this.contentType;if(!n)return;n.indexOf("json")!==-1?o="json":n.indexOf("xml")!==-1?o="xml":n.indexOf("form-urlencoded")!==-1&&(o="form"),this.set("selected",o)}else this.set("selected","code-mirror")},clearForm:function(){switch(this.selected){case"code-mirror":this.set("_valueCodeMirror","");break;case"json":this.set("_valueJson","");break;case"xml":this.set("_valueXml","");break;case"form":this.set("_valueForm","")}}});</script>
</dom-module>
</body></html>