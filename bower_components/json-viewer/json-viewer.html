<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../text-search-behavior/text-search-behavior.html">
<link rel="import" href="../paper-spinner/paper-spinner.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="js-max-number-error.html">


</head><body><dom-module id="json-viewer">
  <template>
    <style>
     :host {
      display: block;
      font-family: monospace;
      font-size: 10pt;
      color: black;
      cursor: text;
      -webkit-user-select: text;
      @apply(--json-viewer);
    }

    .prettyPrint {
      padding: 8px;
    }

    .stringValue {
      white-space: normal;
    }

    .brace {
      display: inline-block;
    }

    .numeric {
      color: var(--code-type-number-value-color, blue);
    }

    .nullValue {
      color: var(--code-type-null-value-color, #708);
    }

    .booleanValue {
      color: var(--code-type-boolean-value-color, #708);
    }

    .punctuation {
      color: var(--code-punctuation-value-color, black);
    }

    .stringValue {
      color: var(--code-type-text-value-color, #48A);
    }

    .node {
      position: relative;
      white-space: nowrap;
      margin-bottom: 4px;
      word-wrap: break-word;
    }

    .array-counter {
      color: gray;
      font-size: 11px;
    }

    .array-counter::before {
      content: "Array[" attr(count) "]";
      user-select: none;
      pointer-events: none;
    }

    *[data-expanded="false"] > .array-counter::before {
      content: "Array[" attr(count) "] ...";
      user-select: none;
      pointer-events: none;
    }

    .array-key-number::before {
      content: "" attr(index) ":";
      user-select: none;
      pointer-events: none;
    }

    .key-name {
      color: var(--code-type-text-value-color, #48A);
    }

    .rootElementToggleButton {
      position: absolute;
      top: 0;
      left: -9px;
      font-size: 14px;
      cursor: pointer;
      font-weight: bold;
      user-select: none;
    }

    .rootElementToggleButton::after {
      content: "-";
    }

    .array-key-number {
      color: var(--code-array-index-color, rgb(119, 119, 119));
    }

    .info-row {
      display: none;
      margin: 0 8px;
      text-indent: 0;
    }

    div[data-expanded="false"] div[collapse-indicator] {
      display: inline-block !important;
    }

    div[data-expanded="false"] div[data-element] {
      display: none !important;
    }

    .arc-search-mark.selected {
      background-color: #ff9632;
    }

    div[data-expanded="false"] .punctuation.hidden {
      opacity: 0;
    }

    .hidden {
      color: rgba(0, 0, 0, 0.24);
    }

    a[response-anchor] {
      color: var(--code-type-link-color, #1976d2);
    }

    paper-spinner:not([active]) {
      display: none;
    }

    .actions-panel {
      @apply(--layout-horizontal);
      @apply(--layout-center);
      @apply(--response-raw-viewer-action-bar);
    }

    .actions-panel.hidden {
      display: none;
    }
    </style>
    <paper-spinner active="[[working]]"></paper-spinner>
    <div class="error" hidden$="[[!isError]]">
      <p>There was an error parsing JSON data</p>
    </div>
    <div class$="[[_computeActionsPanelClass(showOutput)]]">
      <content select="[content-action]"></content>
    </div>
    <output id="output" hidden$="[[!showOutput]]" on-tap="_handleDisplayClick"></output>
    <script id="jsonWorker" type="text/js-worker">function JSONViewer(e){var s=e.json;if(this.rawData=e.raw||"",this.cssPrefix=e.cssPrefix||"",this.debug=e.debug||!1,this._numberIndexes={},this.jsonValue=null,this.latestError=null,this.elementsCounter=0,"string"==typeof s)try{this.jsonValue=JSON.parse(s),this.rawData||(this.rawData=s)}catch(e){this.latestError=e.message}else this.jsonValue=s}var SafeHtmlUtils={AMP_RE:new RegExp(/&/g),GT_RE:new RegExp(/>/g),LT_RE:new RegExp(/</g),SQUOT_RE:new RegExp(/'/g),QUOT_RE:new RegExp(/"/g),htmlEscape:function(e){return e.indexOf("&")!==-1&&(e=e.replace(SafeHtmlUtils.AMP_RE,"&amp;")),e.indexOf("<")!==-1&&(e=e.replace(SafeHtmlUtils.LT_RE,"&lt;")),e.indexOf(">")!==-1&&(e=e.replace(SafeHtmlUtils.GT_RE,"&gt;")),e.indexOf('"')!==-1&&(e=e.replace(SafeHtmlUtils.QUOT_RE,"&quot;")),e.indexOf("'")!==-1&&(e=e.replace(SafeHtmlUtils.SQUOT_RE,"&#39;")),e}};JSONViewer.prototype.mark=function(e){this.debug&&performance in self&&performance.mark(e)},JSONViewer.prototype.getMeasurements=function(){if(this.debug&&performance in self){performance.measure("get-html","get-html-start","get-html-end");var e=performance.getEntriesByType("mark");e.forEach(function(e){if(~e.name.indexOf("parse-start-")){var s=e.name.substr(12);performance.measure("parse-"+s,"parse-start-"+s,"parse-start-"+s)}});var e=performance.getEntriesByType("measure"),s=e.map(function(e){return{duration:e.duration,name:e.name,startTime:e.startTime}});return{items:s}}},JSONViewer.prototype.getHTML=function(){this.mark("get-html-start");var e='<div class="'+this.cssPrefix+'prettyPrint">';return e+=this.parse(this.jsonValue),e+="</div>",this.mark("get-html-end"),e},JSONViewer.prototype.parse=function(e,s){s=s||{},this.__parseCallCounter=this.__parseCallCounter||0,this.__parseCallCounter++,this.mark("parse-start-"+this.__parseCallCounter);var t="";return t+=null===e?this.parseNullValue():"number"==typeof e?this.parseNumericValue(e):"boolean"==typeof e?this.parseBooleanValue(e):"string"==typeof e?this.parseStringValue(e):e instanceof Array?this.parseArray(e):this.parseObject(e),s.hasNextSibling&&!s.holdComa&&(t+='<span class="'+this.cssPrefix+'punctuation hidden">,</span>'),this.mark("parse-end-"+this.__parseCallCounter),t},JSONViewer.prototype.parseNullValue=function(){var e="";return e+='<span class="'+this.cssPrefix+'nullValue">',e+="null",e+="</span>"},JSONViewer.prototype.parseNumericValue=function(e){var s;if(e>9007199254740991){var t=String(e);t=t.substr(0,16);var r=new RegExp(t+"(\\d+),?","gim");t in this._numberIndexes&&(r.lastIndex=this._numberIndexes[t]);var a=r.exec(this.rawData);a&&(this._numberIndexes[t]=a.index,s=t+a[1])}var n="";return n+='<span class="'+this.cssPrefix+'numeric">',s&&(n+='<js-max-number-error class="'+this.cssPrefix+'number-error" expected-number="'+s+'">'),n+=e+"",s&&(n+="</js-max-number-error>"),n+="</span>"},JSONViewer.prototype.parseBooleanValue=function(e){var s="";return s+='<span class="'+this.cssPrefix+'booleanValue">',s+=null!==e&&void 0!==e?e+"":"null",s+="</span>"},JSONViewer.prototype.parseStringValue=function(e){var s="",t=e||"";return null!==t&&void 0!==t?(t=SafeHtmlUtils.htmlEscape(t),"/"!==t.slice(0,1)&&"http"!==t.substr(0,4)||(t='<a class="'+this.cssPrefix+'" title="Click to insert into URL field" response-anchor add-root-url href="'+t+'">'+t+"</a>")):t="null",s+="&quot;",s+='<span class="'+this.cssPrefix+'stringValue">',s+=t,s+="</span>",s+="&quot;"},JSONViewer.prototype.parseObject=function(e){var s="";return s+="{",s+='<div collapse-indicator class="'+this.cssPrefix+'info-row">...</div>',Object.getOwnPropertyNames(e).forEach(function(t,r,a){var n=e[t],i=r+1===a.length,l={hasNextSibling:!i};n instanceof Array&&(l.holdComa=!0);var o=this.elementsCounter++,p=this.parse(n,l),u=this.elementsCounter-o>1;s+='<div data-element="'+o+'" style="margin-left: 24px" class="'+this.cssPrefix+'node">';var c=isNaN(t);c&&(s+="&quot;"),s+=this.parseKey(t),c&&(s+="&quot;"),s+=": "+p,u&&(s+='<div data-toggle="'+o+'" class="'+this.cssPrefix+'rootElementToggleButton"></div>'),s+="</div>"},this),s+="}"},JSONViewer.prototype.parseArray=function(e){var s=e.length,t="";t+='<span class="'+this.cssPrefix+'punctuation hidden">[</span>',t+='<span class="'+this.cssPrefix+'array-counter brace punctuation" count="'+s+'"></span>';for(var r=0;r<s;r++){var a=this.elementsCounter++,n=r+1===s,i=this.parse(e[r],{hasNextSibling:!n}),l=this.elementsCounter-a>1;t+='<div data-element="'+a+'" style="margin-left: 24px" class="'+this.cssPrefix+'node">',t+='<span class="'+this.cssPrefix+'array-key-number" index="'+r+'"> &nbsp;</span>',t+=i,l&&(t+='<div data-toggle="'+a+'" class="'+this.cssPrefix+'rootElementToggleButton"></div>'),t+="</div>"}return t+='<span class="'+this.cssPrefix+'punctuation hidden">],</span>'},JSONViewer.prototype.parseKey=function(e){var s="";return s+='<span class="'+this.cssPrefix+'key-name">'+e+"</span>"},self.onmessage=function(e){try{var s=new JSONViewer(e.data);if(null!==s.latestError)return void self.postMessage({message:s.latestError,error:!0});var t=s.getHTML(),r={message:t,error:!1};e.data.debug&&(r.measurement=s.getMeasurements()),self.postMessage(r),s=null}catch(e){self.postMessage({message:e.message,error:!0})}};</script>
  </template>
  <script>Polymer({is:"json-viewer",properties:{json:{type:String,observer:"_changed"},raw:String,isError:{type:Boolean,readOnly:!0,value:!1,notify:!0},working:{type:Boolean,readOnly:!0,value:!1,notify:!0},showOutput:{type:Boolean,readOnly:!0,value:!1,computed:"_computeShowOutput(working, isError, json)"},_worker:Object,_workerDataHandler:{type:Function,value:function(){return this._workerData.bind(this)}},_workerErrorHandler:{type:Function,value:function(){return this._workerError.bind(this)}},_textSearch:{type:HTMLElement,value:function(){return this.$.output}},query:{type:String,observer:"_queryChanged"},debug:Boolean},behaviors:[ArcBehaviors.TextSearchBehavior],detached:function(){this._worker&&(this._worker.removeEventListener("message",this._workerDataHandler),this._worker.removeEventListener("error",this._workerErrorHandler),this._worker=void 0)},ready:function(){this._isReady=!0,this.json&&this._changed(this.json)},_changed:function(e){if(this._isReady&&(this._setIsError(!1),this.$.output.innerText="",void 0!==e)){var t;if(null===e)return t='<div class="prettyPrint"><span class="nullValue">null',t+="</span></div>",this.$.output.innerHTML=t,void this.$.output.removeAttribute("hidden");if(e===!1)return t='<div class="prettyPrint"><span class="booleanValue">false',t+="</span></div>",this.$.output.innerHTML=t,void this._setShowOutput(!0);if(this._setWorking(!0),!this._worker){var r=new Blob([this.$.jsonWorker.textContent],{type:"text/javascript"}),n=new Worker(window.URL.createObjectURL(r));n.addEventListener("message",this._workerDataHandler),n.addEventListener("error",this._workerErrorHandler),this._worker=n}var i=this.debug,s=navigator.userAgent;s.indexOf("MSIE ")===-1&&s.indexOf("Trident")===-1||(i=!1),this._worker.postMessage({json:e,raw:this.raw,cssPrefix:this.nodeName.toLowerCase()+" style-scope ",debug:i})}},_workerData:function(e){var t=e.data;t.error?(this._setIsError(!0),this.$.output.innerHTML=t.message):this.$.output.innerHTML=t.message,this._setWorking(!1),this.debug&&t.measurement.items&&t.measurement.items.length&&(console.groupCollapsed("JSON viewer parse measurements"),console.table(t.measurement.items),console.groupEnd()),this.fire("json-viewer-parsed")},_workerError:function(){this._setIsError(!0),this._setWorking(!1),this.fire("json-viewer-parsed")},_computeShowOutput:function(e,t,r){return!e&&(!!t||!!r&&null!==r&&r!==!1)},_handleDisplayClick:function(e){if(e.target){if("A"===e.target.nodeName)return e.preventDefault(),void this.fire("action-link-change",{url:e.target.getAttribute("href")});var t=e.target.dataset.toggle;if(t){var r=Polymer.dom(this.root).querySelector('div[data-element="'+t+'"]');if(r){var n=r.dataset.expanded;n&&"true"!==n?r.dataset.expanded="true":r.dataset.expanded="false"}}}},_queryChanged:function(e){return e?void this.mark(e):void this.cleanMarked()},_computeActionsPanelClass:function(e){var t="actions-panel";return e||(t+=" hidden"),t}});</script>
</dom-module>
</body></html>