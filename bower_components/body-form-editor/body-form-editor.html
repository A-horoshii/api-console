<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../marked-element/marked-element.html">
<link rel="import" href="../markdown-styles/markdown-styles.html">
<link rel="import" href="../iron-validatable-behavior/iron-validatable-behavior.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../arc-icons/arc-icons.html">
<link rel="import" href="../paper-button/paper-button.html">


</head><body><dom-module id="body-form-editor">
  <template>
    <style>
    :host {
      display: block;
      padding: 8px;

      @apply(--raml-request-parameters-form);
      @apply(--body-form-editor);

      --paper-input-container-label: {
        color: var(--raml-request-parameters-editor-input-label-color, rgba(0, 0, 0, 0.48));
      }
    }

    .user-defined-row,
    .predefined-row {
      @apply(--layout-horizontal);
      position: relative;

    }

    .predefined-row {
      @apply(--raml-request-parameters-editor-predefined-row);
    }

    .user-defined-row {
      @apply(--raml-request-parameters-editor-user-defined-row);
    }

    .predefined-row label {
      display: block;
      min-width: 120px;
      @apply(--layout-horizontal);
      @apply(--layout-end-justified);
      @apply(--paper-font-body1);
      font-size: 15px;
      color: var(--raml-request-parameters-editor-predefined-label-color, rgba(0, 0, 0, 0.87));
      text-align: right;
      margin-right: 8px;
      padding-top: 12px;
      @apply(--form-label);
    }

    .param-name {
      margin-right: 8px;
      @apply(--layout-flex);
    }

    .param-value {
      @apply(--layout-vertical);
      @apply(--layout-flex);
    }

    .param-value .input {
      @apply(--layout-horizontal);
    }

    paper-input {
      width: 100%;
    }

    .docs {
      @apply(--paper-font-common-base);
      font-size: 13px;
      font-weight: 200;
      line-height: 24px;
      color: var(--raml-request-parameters-editor-docs-color, rgba(0, 0, 0, 0.87));
    }

    .action-button {
      color: var(--primary-color);
    }

    .markdown-html p:first-child {
      margin-top: 0;
      padding-top: 0;
    }

    .markdown-html p:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
    }

    paper-icon-button {
      @apply(--icon-button);
    }

    paper-icon-button:hover {
      @apply(--icon-button-hover);
    }

    </style>
    <form is="iron-form" id="form">
      <template is="dom-repeat" items="{{schema}}">
        <div class="predefined-row">
          <label class="label" for="body-form-editor-[[index]]" hidden="[[narrow]]">[[item.name]]<span hidden$="[[!item.required]]">*</span></label>
          <div class="param-value">
            <template is="dom-if" if="[[_computeIsEnum(item.enum)]]" restamp="">
              <paper-dropdown-menu no-label-float="" label="[[_computeInputLabel(item.*, narrow)]]" name="[[item.name]]" required="" id="body-form-editor-[[index]]">
                <paper-listbox class="dropdown-content" attr-for-selected="data-value" selected="{{item.value}}">
                  <template is="dom-repeat" items="[[item.enum]]">
                    <paper-item data-value="[[item]]">[[item]]</paper-item>
                  </template>
                  <paper-item label=" ">(empty value)</paper-item>
                </paper-listbox>
              </paper-dropdown-menu>
            </template>
            <template is="dom-if" if="[[!_computeIsEnum(item.enum)]]" restamp="">
              <div class="input">
                <paper-input no-label-float="[[!narrow]]" label="[[_computeInputLabel(item.*, narrow)]]" id="body-form-editor-[[index]]" value="{{item.value}}" required="[[item.required]]" pattern="[[item.pattern]]" name="[[item.name]]" auto-validate="" type="[[_computeInputType(item.type)]]" min="[[item.minimum]]" max="[[item.maximum]]" maxlength="[[item.maxLength]]"></paper-input>
              </div>
            </template>
            <div class="docs" hidden$="[[!_hasValue(item.description)]]">
              <marked-element markdown="[[item.description]]">
                <div class="markdown-html markdown-body"></div>
              </marked-element>
            </div>
          </div>
        </div>
      </template>
      <template is="dom-repeat" items="{{userParams}}" user-params="">
        <div class="user-defined-row">
          <div class="param-name">
            <paper-input no-label-float="[[!narrow]]" label="Param name" value="{{item.name}}" type="text"></paper-input>
          </div>
          <div class="param-value">
            <div class="input">
              <paper-input no-label-float="[[!narrow]]" label="Param value" name="[[item.name]]" value="{{item.value}}" type="text"></paper-input>
            </div>
          </div>
          <paper-icon-button icon="arc:close" on-tap="_removeUserParam" title="Remove form parameter"></paper-icon-button>
        </div>
      </template>
      <div class="add-action">
        <paper-button class="action-button" on-tap="_addUserParam" title="Add form parameter">add</paper-button>
      </div>
    </form>
  </template>
  <script>Polymer({is:"body-form-editor",behaviors:[Polymer.IronValidatableBehavior],properties:{type:Object,value:{type:String,notify:!0,value:""},opened:{type:Boolean,value:!0},schema:Array,narrow:{type:Boolean,value:!1},userParams:Array},observers:["_typeChanged(type.*)","_schemaChanged(schema.*)","_schemaChanged(userParams.*)","_valueChanged(opened, value)"],_typeChanged:function(e){var a=e.base;a&&a.formParameters?this.schema=this.readSchema(a.formParameters):this.schema=void 0},_computeIsEnum:function(e){return!(!e||!e.length)},_computeInputType:function(e){if(!e||"text"===e)return"text";switch(e){case"number":case"integer":case"float":return"number";default:return"text"}},_computeInputLabel:function(e,a){var r=e.base;if(r)return a?r.name:r.examples&&r.examples.length&&r.examples[0]?"Example: "+r.examples[0]:"Param value"},_hasValue:function(e){return"number"==typeof e&&0===e||("boolean"==typeof e||!!e)},_getValidity:function(){return this.$.form.validate()},readSchema:function(e){if(!e)return[];if(e instanceof Array)return e;var a=Object.keys(e);return a?a.map(function(a){var r=e[a];return r.key=a,"undefined"==typeof r.default||r.value||(r.value=r.default),"undefined"==typeof r.value&&r.required&&(r.examples?r.value=r.examples[0]:r.example&&(r.value=r.example),r.value&&r.value.indexOf&&0===r.value.indexOf(r.name+"=")&&(r.value=r.value.substr(r.name.length+1))),"undefined"==typeof r.value&&r.enum&&r.enum.length&&(r.value=r.enum[0]),Object.assign({},r)}):[]},_schemaChanged:function(){this.async(function(){var e=this.$.form.serialize(),a=this._wwwFormUrlEncode(e);this._internalValueChange=!0,this.set("value",a),this._internalValueChange=!1},1)},_wwwFormUrlEncode:function(e){if(!e)return"";var a=[];return Object.keys(e).forEach(function(r){var t=e[r];(t||this._isKeyRequired(r))&&a.push(this._wwwFormUrlEncodePiece(r)+"="+this._wwwFormUrlEncodePiece(t))},this),a.join("&")},_wwwFormUrlEncodePiece:function(e){return e?encodeURIComponent(e.toString().replace(/\r?\n/g,"\r\n")).replace(/%20/g,"+"):""},_wwwFormUrlDecode:function(e){return e?decodeURIComponent(e.toString().replace(/\+/g," ")):""},_isKeyRequired:function(e){if(!e)return!1;var a=this.schema;if(!a||!a.length)return!1;for(var r=0,t=a.length;r<t;r++)if(a[r].key===e)return a[r].required===!0;return!1},_valueChanged:function(e,a){if(e&&!this._internalValueChange){if(!a)return this._updateValues({});var r=this._deserializeValues(a);this._updateValues(r)}},_deserializeValues:function(e){if(!e||"string"!=typeof e)return{};var a=e.split("&").map(function(e){if(!e)return null;var a=e.split("=");return a.length?{name:this._wwwFormUrlDecode(a[0]),value:this._wwwFormUrlDecode(a[1])}:null},this).filter(function(e){return!!e}),r={};return a.forEach(function(e){r[e.name]=e.value}),r},_updateValues:function(e){e=e||{};var a=Object.keys(e),r=this.schema;if(r&&r.forEach(function(r,t){var n=r.name,u=a.indexOf(n);u===-1?this.set(["schema",t,"value"],""):(this.set(["schema",t,"value"],e[n]),a.splice(u,1))},this),a.length){this.userParams||(this.userParams=[]);var t=this.userParams.map(function(e,r){return a.indexOf(e.name)===-1?(this.splice("userParams",r,1),null):e.name},this).filter(function(e){return!!e});a.forEach(function(a){var r=t.indexOf(a);r!==-1?this.set(["userParams",r,"value"],e[a]):this.push("userParams",{name:a,value:e[a]})},this)}},_removeUserParam:function(e){var a=this.$$("template[user-params]"),r=a.indexForElement(e.target);void 0!==r&&r!==-1&&this.splice("userParams",r,1)},_addUserParam:function(){this.userParams||(this.userParams=[]),this.push("userParams",{name:"",value:""})}});</script>
</dom-module>
</body></html>